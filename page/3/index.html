<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5G1RK23V7S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5G1RK23V7S');
</script>
  <meta property="og:type" content="website">
<meta property="og:title" content="Steven 的學習筆記">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Steven 的學習筆記">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Steven Wu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Steven 的學習筆記</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5G1RK23V7S"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-5G1RK23V7S');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Steven 的學習筆記</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">沒有解決不了的問題<br>只有未找到解決方法</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/06/frontend-d3-010-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/06/frontend-d3-010-tools/" class="post-title-link" itemprop="url">D3 - 010 Tools</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-06 13:16:29" itemprop="dateCreated datePublished" datetime="2022-02-06T13:16:29+08:00">2022-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:14" itemprop="dateModified" datetime="2022-02-08T16:17:14+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>d3.range( start, stop, step ) : 返回一個數值陣列．以 start 為陣列的第一個元素 (預設為 0)，每間隔 step (step 預設為 1) 取一個數值，直到 stop</li>
<li>d3.shuffle( array, low, high ) : 對陣列內的索引 low 到 high 間的元素做洗牌動作，若沒有指定 low 和 high 則對陣列的所有元素做洗牌．</li>
<li>d3.cross( a, b, reducer ) : 傳入一維陣列 a 及 b．透過 reducer 函數，預設會產出一個 2 元素陣列，[ [a1, b1], [a1, b2], …, [a2, b1], [a2, b2], … ]</li>
<li>d3.merge( array1, array2, … ) : 合併多個一維陣列</li>
<li>d3.parirs( array, reducer ) : 對相臨兩元素，透過 reducer 函數，預設會產出一個 2 元素陣列，[ [a1, a1], [a2, a3], … ]</li>
<li>d3.transpose( matrix ) : 返回轉置矩陣</li>
<li>d3.min( array, accessor ) : 取得 array 中的最小值</li>
<li>d3.max( array, accessor ) : 取得 array 中的最大值</li>
<li>d3.extent( array, accessor ) : 返回 [min, max]</li>
<li>d3.sum( array, accessor ) : 傳回元素的總和</li>
<li>d3.mean( array, accessor ) : 傳回元素的平均值<br>其他完整的 D3 API : <a target="_blank" rel="noopener" href="https://github.com/d3/d3/blob/main/API.md">https://github.com/d3/d3/blob/main/API.md</a></li>
</ul>
<p>直方圖是一個 Layout，傳回一個由一組箱子所組成的陣列．每個箱子都是包含 length 屬性 (元素數目)， x0 及 x1 屬性項組成．</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo10_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.csv( <span class="string">&quot;data/dense.csv&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params"> data </span>) </span>&#123;                        </span><br><span class="line">        <span class="keyword">var</span> histo = d3.histogram().value( <span class="function"><span class="params">d</span>=&gt;</span>+d.A )( data );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> scX = d3.scaleBand().padding( <span class="number">0.2</span> ).round( <span class="literal">true</span> )</span><br><span class="line">            .range( [<span class="number">15</span>, <span class="number">515</span>] ).domain( histo );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> scY = d3.scaleLinear().range( [<span class="number">200</span>, <span class="number">0</span>] )</span><br><span class="line">            .domain( [<span class="number">0</span>, d3.max( histo, <span class="function"><span class="params">d</span>=&gt;</span>d.length ) ] ).nice();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> )</span><br><span class="line">            .append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 40,50 )&quot;</span> )</span><br><span class="line"></span><br><span class="line">        g.selectAll( <span class="string">&quot;rect&quot;</span> ).data( histo ).enter()</span><br><span class="line">            .append( <span class="string">&quot;rect&quot;</span> ).attr( <span class="string">&quot;width&quot;</span>, scX.bandwidth() )</span><br><span class="line">            .attr( <span class="string">&quot;x&quot;</span>, scX ).attr( <span class="string">&quot;y&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY(d.length) )</span><br><span class="line">            .attr( <span class="string">&quot;height&quot;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="number">200</span>-scY(d.length) )</span><br><span class="line">            .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;fill-opacity&quot;</span>, <span class="number">0.2</span> )</span><br><span class="line">            .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">2</span> )</span><br><span class="line"></span><br><span class="line">        g.selectAll( <span class="string">&quot;text&quot;</span> ).data( histo ).enter().append( <span class="string">&quot;text&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;font-family&quot;</span>, <span class="string">&quot;sans-serif&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;font-size&quot;</span>, <span class="number">14</span> )        </span><br><span class="line">            .attr( <span class="string">&quot;x&quot;</span>, <span class="function"><span class="params">d</span> =&gt;</span> scX(d)+<span class="number">0.5</span>*scX.bandwidth() )</span><br><span class="line">            .attr( <span class="string">&quot;y&quot;</span>, <span class="number">225</span> )</span><br><span class="line">            .text( <span class="function"><span class="params">d</span>=&gt;</span>(d.x0+d.x1)/<span class="number">2</span> );</span><br><span class="line"></span><br><span class="line">        g.append( <span class="string">&quot;g&quot;</span> ).call( d3.axisLeft(scY) );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo10_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo10_1()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;575&quot;</span> <span class="attr">height</span>=<span class="string">&quot;325&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo10_1;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/06/frontend-d3-010-tools/01.png" class="" title="01.png">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/02/frontend-d3-009-tree-network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/02/frontend-d3-009-tree-network/" class="post-title-link" itemprop="url">D3 - 009 樹與網路</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-02 23:37:40" itemprop="dateCreated datePublished" datetime="2022-02-02T23:37:40+08:00">2022-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:14" itemprop="dateModified" datetime="2022-02-08T16:17:14+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>14 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>代碼參考 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/trees.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/trees.js</a><br>D3 階層式 Layout 需要把資料表示成 D3 Node 實例樹 (適合的資料結構)，如果資料是階層式格式，則可以用 d3.hierarchy() 轉換，如果資料是以提供在父節點和子節點之間的連結集合，則 d3.stratify() 可以用來建構所需的 Node 實例樹．<a target="_blank" rel="noopener" href="https://observablehq.com/@d3/d3-stratify">d3.stratify() Examples</a></p>
<ul>
<li>d3.hierarchy( data, accessor ) : 從 data 中建立一個 Node 實例樹，傳回 root node．accessor 預設為 d =&gt; d.children，傳回一個子節點陣列．</li>
<li>node.ancestors() : 傳回祖先節點陣列</li>
<li>node.descendants() : 傳回後代節點陣列</li>
<li>node.leaves() : 傳回葉節點陣列</li>
<li>node.path( target ) : 傳回一條從目前節點到目的節點的最短路徑</li>
<li>node.links() : 傳回連結關係陣列，每個陣列元素是一個物件，具有 source 和 target 屬性．</li>
<li>node.count() : 計算所屬子樹下的葉數目，結果會被紀錄在節點上的 value 屬性上，葉節點的 value 屬性會被記錄為 1</li>
<li>node.sum( accessor ) : 以 post-order traversal 的方式加總每個節點的資料並設定到 value 屬性中</li>
<li>node.sort( comparator ) : 以 preorder traversal 方式排序</li>
<li>node.each( function ) : 在目前以及每個後代節點上呼叫提供的 function</li>
<li>node.copy() : 傳回子樹的複本</li>
</ul>
<p>D3 Node 實例的屬性</p>
<ul>
<li>node.data : 原始資料集</li>
<li>node.depth : 與根節點的距離</li>
<li>node.height : 到最深的葉節點距離，葉節點的高度為 0</li>
<li>node.parent : 父節點．根節點的父節點為 null</li>
<li>node.children : 子節點陣列．葉節點的子節點為 undefined</li>
<li>node.value : 放置由 count() 或 sum() 所計算的值</li>
</ul>
<p>d3.tree 及 d3.cluster 的方法</p>
<ul>
<li>d3.tree() : 傳回一個 tree layout 實例，具有相同深度的節點，將會放在距離 root 節點相同像素的位置</li>
<li>d3.cluster() : 傳回一個 tree layout 實例，所有葉節點，將會放在距離 root 節點相同像素的位置</li>
<li>t( node ) : 輸入一個 D3 Node 物件樹的根節點</li>
<li>t.size( [x, y] ) : 結果圖形的大小</li>
<li>t.nodeSize( [x, y] ) : 單一個節點的大小<br>節點原始資料<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;root&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">0</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">    &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;bin&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;boot&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">1</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;dev&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">1</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;home&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">0</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;alice&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">5</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;mail&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;img&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">1</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">                &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;color&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">8</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">                &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;bw&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;</span><br><span class="line">            ] &#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;files&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">4</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;</span><br><span class="line">        ] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;eve&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">1</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;spy&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">2</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;</span><br><span class="line">        ] &#125;,	</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;bob&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;mail&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">4</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;docs&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">7</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;src&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">5</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;</span><br><span class="line">        ] &#125;</span><br><span class="line">    ] &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;lib&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">9</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;usr&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">0</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;bin&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;include&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">6</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;lib&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">9</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;local&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">7</span>, <span class="attr">&quot;kids&quot;</span>: [</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;bin&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">2</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;lib&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;,</span><br><span class="line">            &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;share&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;</span><br><span class="line">        ] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;share&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">4</span>, <span class="attr">&quot;kids&quot;</span>: [] &#125;</span><br><span class="line">    ] &#125;</span><br><span class="line">] &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/filesys.json&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;    </span><br><span class="line">        <span class="keyword">var</span> nodes = d3.hierarchy(json, <span class="function"><span class="params">d</span>=&gt;</span>d.kids);  <span class="comment">// 建構 D3 Node 物件樹，其子節點是被儲存在 kids 中</span></span><br><span class="line">        d3.tree().size( [<span class="number">250</span>,<span class="number">225</span>] )( nodes );  <span class="comment">// 設定完整圖形的像素尺寸</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(25, 25)&quot;</span> );</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> lnkMkr = d3.linkVertical().x( <span class="function"><span class="params">d</span>=&gt;</span>d.x ).y( <span class="function"><span class="params">d</span>=&gt;</span>d.y );  <span class="comment">// 節點間的連結線產生器</span></span><br><span class="line">        g.selectAll( <span class="string">&quot;path&quot;</span> ).data( nodes.links() ).enter()  <span class="comment">// 產生連結線</span></span><br><span class="line">            .append( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;d&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>lnkMkr(d) )</span><br><span class="line">            .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> );</span><br><span class="line">        </span><br><span class="line">        g.selectAll(<span class="string">&quot;circle&quot;</span>).data( nodes.descendants() ).enter()  <span class="comment">// 傳回後代陣列畫點</span></span><br><span class="line">            .append(<span class="string">&quot;circle&quot;</span>).attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> )</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.x ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.y );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_1()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;275&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_1;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/01.png" class="" title="01.png">
<p>d3.tree() 是依據輸入順序繪製，而要使用 d3.cluster() 之前必須依據高度重新排列後，在輸入給 d3.cluster()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/filesys.json&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;    </span><br><span class="line">        <span class="keyword">var</span> nodes = d3.hierarchy(json, <span class="function"><span class="params">d</span>=&gt;</span>d.kids);  <span class="comment">// 建構 D3 Node 物件樹，其子節點是被儲存在 kids 中</span></span><br><span class="line">        nodes = nodes.sort( <span class="function">(<span class="params">a, b</span>) =&gt;</span> b.height - a.height );  <span class="comment">// 依據高度排列</span></span><br><span class="line">        d3.cluster().size( [<span class="number">250</span>,<span class="number">225</span>] )( nodes );  <span class="comment">// 設定完整圖形的像素尺寸</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(25, 25)&quot;</span> );</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> lnkMkr = d3.linkVertical().x( <span class="function"><span class="params">d</span>=&gt;</span>d.x ).y( <span class="function"><span class="params">d</span>=&gt;</span>d.y );  <span class="comment">// 節點間的連結線產生器</span></span><br><span class="line">        g.selectAll( <span class="string">&quot;path&quot;</span> ).data( nodes.links() ).enter()  <span class="comment">// 產生連結線</span></span><br><span class="line">            .append( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;d&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>lnkMkr(d) )</span><br><span class="line">            .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> );</span><br><span class="line">        </span><br><span class="line">        g.selectAll(<span class="string">&quot;circle&quot;</span>).data( nodes.descendants() ).enter()  <span class="comment">// 傳回後代陣列畫點</span></span><br><span class="line">            .append(<span class="string">&quot;circle&quot;</span>).attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> )</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.x ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.y );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_2()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;275&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_2;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/02.png" class="" title="02.png">
<p>以水平方式繪製 tree</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/filesys.json&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;    </span><br><span class="line">        <span class="keyword">var</span> nodes = d3.hierarchy(json, <span class="function"><span class="params">d</span>=&gt;</span>d.kids);</span><br><span class="line">        d3.tree().size( [<span class="number">250</span>,<span class="number">225</span>] )( nodes );</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(25, 25)&quot;</span> );</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> lnkMkr = d3.linkHorizontal().x( <span class="function"><span class="params">d</span>=&gt;</span>d.y ).y( <span class="function"><span class="params">d</span>=&gt;</span>d.x );  <span class="comment">// 以水平方式繪製節點間的連結</span></span><br><span class="line">        g.selectAll( <span class="string">&quot;path&quot;</span> ).data( nodes.links() ).enter()</span><br><span class="line">            .append( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;d&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>lnkMkr(d) )</span><br><span class="line">            .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> );</span><br><span class="line">        </span><br><span class="line">        g.selectAll(<span class="string">&quot;circle&quot;</span>).data( nodes.descendants() ).enter()</span><br><span class="line">            .append(<span class="string">&quot;circle&quot;</span>).attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> )</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.y ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.x );  <span class="comment">// 因為是水平繪製，所以此處 x 和 y 要對調</span></span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_3()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">width</span>=<span class="string">&quot;275&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_3;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/03.png" class="" title="03.png">

<p>使用極坐標</p>
<img src="/2022/02/02/frontend-d3-009-tree-network/04.png" class="" title="04.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/filesys.json&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;    </span><br><span class="line">        <span class="keyword">var</span> nodes = d3.cluster().size( [<span class="number">2</span>*<span class="built_in">Math</span>.PI, <span class="number">125</span>] )(  <span class="comment">// 使用 radial 方式繪製的話，需要用極座標</span></span><br><span class="line">            d3.hierarchy( json, <span class="function"><span class="params">d</span>=&gt;</span>d.kids )</span><br><span class="line">                .sort( <span class="function">(<span class="params">a,b</span>)=&gt;</span>b.height-a.height )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(150, 150)&quot;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> h = <span class="function"><span class="keyword">function</span>(<span class="params"> r, phi </span>) </span>&#123; <span class="keyword">return</span>  r*<span class="built_in">Math</span>.sin(phi) &#125;  <span class="comment">// 定義座標轉換公式</span></span><br><span class="line">        <span class="keyword">var</span> v = <span class="function"><span class="keyword">function</span>(<span class="params"> r, phi </span>) </span>&#123; <span class="keyword">return</span> -r*<span class="built_in">Math</span>.cos(phi) &#125;  </span><br><span class="line">        </span><br><span class="line">        g.selectAll( <span class="string">&quot;line&quot;</span> ).data( nodes.links() ).enter()</span><br><span class="line">            .append( <span class="string">&quot;line&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;x1&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>h(d.source.y, d.source.x) )  <span class="comment">// 座標轉換</span></span><br><span class="line">            .attr( <span class="string">&quot;y1&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>v(d.source.y, d.source.x) )</span><br><span class="line">            .attr( <span class="string">&quot;x2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>h(d.target.y, d.target.x) )</span><br><span class="line">            .attr( <span class="string">&quot;y2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>v(d.target.y, d.target.x) );</span><br><span class="line"></span><br><span class="line">        g.selectAll( <span class="string">&quot;circle&quot;</span> ).data( nodes.descendants() ).enter()</span><br><span class="line">            .append( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> )</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>h(d.y, d.x) )</span><br><span class="line">            .attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>v(d.y, d.x) );</span><br><span class="line">    &#125; )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_4()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_4;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/05.png" class="" title="05.png">

<p>以極座標方式繪製樹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/filesys.json&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;    </span><br><span class="line">        <span class="keyword">var</span> nodes = d3.cluster().size( [<span class="number">2</span>*<span class="built_in">Math</span>.PI, <span class="number">125</span>] )(  <span class="comment">// 使用 radial 方式繪製的話，需要用極座標</span></span><br><span class="line">            d3.hierarchy( json, <span class="function"><span class="params">d</span>=&gt;</span>d.kids )</span><br><span class="line">                .sort( <span class="function">(<span class="params">a,b</span>)=&gt;</span>b.height-a.height )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(150, 150)&quot;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> h = <span class="function"><span class="keyword">function</span>(<span class="params"> r, phi </span>) </span>&#123; <span class="keyword">return</span>  r*<span class="built_in">Math</span>.sin(phi) &#125;  <span class="comment">// 定義座標轉換公式</span></span><br><span class="line">        <span class="keyword">var</span> v = <span class="function"><span class="keyword">function</span>(<span class="params"> r, phi </span>) </span>&#123; <span class="keyword">return</span> -r*<span class="built_in">Math</span>.cos(phi) &#125;  </span><br><span class="line">        </span><br><span class="line">        g.selectAll( <span class="string">&quot;line&quot;</span> ).data( nodes.links() ).enter()</span><br><span class="line">            .append( <span class="string">&quot;line&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;x1&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>h(d.source.y, d.source.x) )  <span class="comment">// 座標轉換</span></span><br><span class="line">            .attr( <span class="string">&quot;y1&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>v(d.source.y, d.source.x) )</span><br><span class="line">            .attr( <span class="string">&quot;x2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>h(d.target.y, d.target.x) )</span><br><span class="line">            .attr( <span class="string">&quot;y2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>v(d.target.y, d.target.x) );</span><br><span class="line"></span><br><span class="line">        g.selectAll( <span class="string">&quot;circle&quot;</span> ).data( nodes.descendants() ).enter()</span><br><span class="line">            .append( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> )</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>h(d.y, d.x) )</span><br><span class="line">            .attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>v(d.y, d.x) );</span><br><span class="line">    &#125; )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_4()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_4;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/06.png" class="" title="06.png">

<p>以 radial 連結產生器取代直線</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_5</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/filesys.json&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;    </span><br><span class="line">        <span class="keyword">var</span> nodes = d3.cluster().size( [<span class="number">2</span>*<span class="built_in">Math</span>.PI, <span class="number">125</span>] )(  <span class="comment">// 使用 radial 方式繪製的話，需要用極座標</span></span><br><span class="line">            d3.hierarchy( json, <span class="function"><span class="params">d</span>=&gt;</span>d.kids )</span><br><span class="line">                .sort( <span class="function">(<span class="params">a,b</span>)=&gt;</span>b.height-a.height )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(150, 150)&quot;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> h = <span class="function"><span class="keyword">function</span>(<span class="params"> r, phi </span>) </span>&#123; <span class="keyword">return</span>  r*<span class="built_in">Math</span>.sin(phi) &#125;  <span class="comment">// 定義座標轉換公式</span></span><br><span class="line">        <span class="keyword">var</span> v = <span class="function"><span class="keyword">function</span>(<span class="params"> r, phi </span>) </span>&#123; <span class="keyword">return</span> -r*<span class="built_in">Math</span>.cos(phi) &#125;  </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        g.selectAll(<span class="string">&quot;path&quot;</span>).data( nodes.links() ).enter().append(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">            .attr( <span class="string">&quot;d&quot;</span>, d3.linkRadial().angle( <span class="function"><span class="params">d</span>=&gt;</span>d.x ).radius( <span class="function"><span class="params">d</span>=&gt;</span>d.y ))  <span class="comment">// 以 radial 方式產生連結線</span></span><br><span class="line">            .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> );</span><br><span class="line"></span><br><span class="line">        g.selectAll( <span class="string">&quot;circle&quot;</span> ).data( nodes.descendants() ).enter()</span><br><span class="line">            .append( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> )</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>h(d.y, d.x) )</span><br><span class="line">            .attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>v(d.y, d.x) );</span><br><span class="line">    &#125; )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_5</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_5()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_5;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/07.png" class="" title="07.png">

<p>之前的 tree / cluster 只是表示出父子階層關係，除了要表示出父子關係外，也要可表現出節點的大小與其子節點大小的話，則可以用 treemap / partition 方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_6</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/filesys.json&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> sc = d3.scaleOrdinal( d3.schemeReds[<span class="number">8</span>] );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> nodes = d3.hierarchy(json, <span class="function"><span class="params">d</span>=&gt;</span>d.kids).sum(<span class="function"><span class="params">d</span>=&gt;</span>d.size)  <span class="comment">// 計算出其後代 size 加總</span></span><br><span class="line">            .sort(<span class="function">(<span class="params">a,b</span>) =&gt;</span> b.height-a.height || b.value-a.value); <span class="comment">// 按高度降冪及數值降冪排序</span></span><br><span class="line">        </span><br><span class="line">        d3.treemap().size( [<span class="number">300</span>,<span class="number">300</span>] ).padding(<span class="number">5</span>)(nodes);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(5, 5)&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        g.selectAll( <span class="string">&quot;rect&quot;</span> ).data( nodes.descendants() ).enter()</span><br><span class="line">            .append( <span class="string">&quot;rect&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;x&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.x0 ).attr( <span class="string">&quot;y&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.y0 )</span><br><span class="line">            .attr( <span class="string">&quot;width&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.x1-d.x0 )  <span class="comment">// treemap layout 提供了兩個對角的 (x0, y0) (x1, y1) </span></span><br><span class="line">            .attr( <span class="string">&quot;height&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.y1-d.y0 )</span><br><span class="line">            .attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>sc(d.depth) ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> );</span><br><span class="line"></span><br><span class="line">        g.selectAll( <span class="string">&quot;text&quot;</span> ).data( nodes.leaves() ).enter()  <span class="comment">// 只為每個葉節點顯示文字</span></span><br><span class="line">            .append( <span class="string">&quot;text&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span> ).attr( <span class="string">&quot;font-size&quot;</span>, <span class="number">10</span> )</span><br><span class="line">            .attr( <span class="string">&quot;x&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>(d.x0+d.x1)/<span class="number">2</span> )</span><br><span class="line">            .attr( <span class="string">&quot;y&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>(d.y0+d.y1)/<span class="number">2</span>+<span class="number">2</span> )</span><br><span class="line">            .text( <span class="function"><span class="params">d</span>=&gt;</span>d.data.name );    </span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_6</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_6()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;310&quot;</span> <span class="attr">width</span>=<span class="string">&quot;310&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_6;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/08.png" class="" title="08.png">

<p>基於作用力的粒子排列，於最後穩態時繪出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/network.json&quot;</span> ).then( <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> )</span><br><span class="line">        <span class="keyword">var</span> scC = d3.scaleOrdinal( d3.schemePastel1 )</span><br><span class="line">        </span><br><span class="line">        d3.shuffle( res.ps ); d3.shuffle( res.ln );</span><br><span class="line">        </span><br><span class="line">        d3.forceSimulation( res.ps )</span><br><span class="line">            .force(<span class="string">&quot;ct&quot;</span>, d3.forceCenter( <span class="number">300</span>, <span class="number">300</span> ) )</span><br><span class="line">            .force(<span class="string">&quot;ln&quot;</span>,</span><br><span class="line">                   d3.forceLink( res.ln ).distance(<span class="number">40</span>).id(<span class="function"><span class="params">d</span>=&gt;</span>d.id) )</span><br><span class="line">            .force(<span class="string">&quot;hc&quot;</span>, d3.forceCollide(<span class="number">10</span>) )</span><br><span class="line">            .force(<span class="string">&quot;many&quot;</span>, d3.forceManyBody() )</span><br><span class="line">            .on( <span class="string">&quot;end&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                svg.selectAll( <span class="string">&quot;line&quot;</span> ).data( res.ln ).enter()</span><br><span class="line">                    .append( <span class="string">&quot;line&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;black&quot;</span> )</span><br><span class="line">                    .attr( <span class="string">&quot;x1&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.source.x )</span><br><span class="line">                    .attr( <span class="string">&quot;y1&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.source.y )</span><br><span class="line">                    .attr( <span class="string">&quot;x2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.target.x )</span><br><span class="line">                    .attr( <span class="string">&quot;y2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.target.y );</span><br><span class="line">            </span><br><span class="line">                svg.selectAll(<span class="string">&quot;circle&quot;</span>).data(res.ps).enter()</span><br><span class="line">                    .append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">                    .attr( <span class="string">&quot;r&quot;</span>, <span class="number">10</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="function">(<span class="params">d,i</span>) =&gt;</span> scC(i) )</span><br><span class="line">                    .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.x ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.y )</span><br><span class="line"></span><br><span class="line">                svg.selectAll(<span class="string">&quot;text&quot;</span>).data(res.ps).enter()</span><br><span class="line">                    .append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">                    .attr( <span class="string">&quot;x&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.x ).attr( <span class="string">&quot;y&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d.y+<span class="number">4</span> )</span><br><span class="line">                    .attr( <span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span> )</span><br><span class="line">                    .attr( <span class="string">&quot;font-size&quot;</span>, <span class="number">10</span> )</span><br><span class="line">                    .text( <span class="function"><span class="params">d</span>=&gt;</span>d.id );</span><br><span class="line">            &#125; )</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_7()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_7;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/09.png" class="" title="09.png">
<p>模擬過程顯示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo09_8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ps = [ &#123; <span class="attr">x</span>: <span class="number">350</span>, <span class="attr">y</span>: <span class="number">300</span>, <span class="attr">vx</span>: <span class="number">0</span>, <span class="attr">vy</span>: <span class="number">1</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">x</span>: <span class="number">250</span>, <span class="attr">y</span>: <span class="number">300</span>, <span class="attr">vx</span>: <span class="number">0</span>, <span class="attr">vy</span>: -<span class="number">1</span> &#125; ];</span><br><span class="line"><span class="keyword">var</span> ln = [ &#123; <span class="attr">index</span>: <span class="number">0</span>, <span class="attr">source</span>: ps[<span class="number">0</span>], <span class="attr">target</span>: ps[<span class="number">1</span>] &#125; ];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cs1 = d3.select( <span class="string">&quot;#simul&quot;</span> ).select( <span class="string">&quot;#c1&quot;</span> );</span><br><span class="line"><span class="keyword">var</span> cs2 = d3.select( <span class="string">&quot;#simul&quot;</span> ).select( <span class="string">&quot;#c2&quot;</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sim = d3.forceSimulation( ps )</span><br><span class="line"> .alphaDecay( <span class="number">0</span> ).alphaMin( -<span class="number">1</span> ).velocityDecay( <span class="number">0</span> )</span><br><span class="line"> .force(<span class="string">&quot;ln&quot;</span>, d3.forceLink(ln).distance(<span class="number">50</span>).strength(<span class="number">0.01</span>))</span><br><span class="line"> .on( <span class="string">&quot;tick&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     cs1.attr( <span class="string">&quot;cx&quot;</span>, ps[<span class="number">0</span>].x ).attr( <span class="string">&quot;cy&quot;</span>, ps[<span class="number">0</span>].y );</span><br><span class="line">     cs2.attr( <span class="string">&quot;cx&quot;</span>, ps[<span class="number">1</span>].x ).attr( <span class="string">&quot;cy&quot;</span>, ps[<span class="number">1</span>].y );</span><br><span class="line"> &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo09_8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo09_8()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">&quot;simul&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">&quot;c1&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;350&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;300&quot;</span> <span class="attr">r</span>=<span class="string">&quot;10&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">&quot;c2&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;250&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;300&quot;</span> <span class="attr">r</span>=<span class="string">&quot;10&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo09_8;</span><br></pre></td></tr></table></figure>
<img src="/2022/02/02/frontend-d3-009-tree-network/10.png" class="" title="10.png">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/02/frontend-d3-008-color/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/02/frontend-d3-008-color/" class="post-title-link" itemprop="url">D3 - 008 Color</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-02 20:17:57" itemprop="dateCreated datePublished" datetime="2022-02-02T20:17:57+08:00">2022-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:14" itemprop="dateModified" datetime="2022-02-08T16:17:14+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>8.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>調色盤倉庫 : <a target="_blank" rel="noopener" href="http://soliton.vm.bytemark.co.uk/pub/cpt-city/index.html">http://soliton.vm.bytemark.co.uk/pub/cpt-city/index.html</a><br>D3 各種調色盤 : <a target="_blank" rel="noopener" href="https://github.com/d3/d3-scale-chromatic">https://github.com/d3/d3-scale-chromatic</a></p>
<h1 id="建立離散顏色集合"><a href="#建立離散顏色集合" class="headerlink" title="建立離散顏色集合"></a>建立離散顏色集合</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  |-- black --|-- red --|-- yellow --|-- white --|</span></span><br><span class="line"><span class="comment">//  0          0.25      0.5          0.75         1</span></span><br><span class="line"><span class="keyword">var</span> sc = d3.scaleQuantize().domain( [<span class="number">0</span>, <span class="number">1</span>] )</span><br><span class="line">    .range( [<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;yellow&quot;</span>, <span class="string">&quot;white&quot;</span>] );</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    -- blue --|-- white --|-- red --</span></span><br><span class="line"><span class="comment">//              -1          1</span></span><br><span class="line"><span class="keyword">var</span> sc = d3.scaleThreshold().domain( [-<span class="number">1</span>, <span class="number">1</span>] )</span><br><span class="line">    .range( [<span class="string">&quot;blue&quot;</span>, <span class="string">&quot;white&quot;</span>, <span class="string">&quot;red&quot;</span>] );</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  good   -&gt; green</span></span><br><span class="line"><span class="comment">//  medium -&gt; yellow</span></span><br><span class="line"><span class="comment">//  bad    -&gt; red</span></span><br><span class="line"><span class="keyword">var</span> sc = d3.scaleOrdinal().domain( [<span class="string">&quot;green&quot;</span>, <span class="string">&quot;yellow&quot;</span>, <span class="string">&quot;red&quot;</span>] )</span><br><span class="line">    .domain( [<span class="string">&quot;good&quot;</span>, <span class="string">&quot;medium&quot;</span>, <span class="string">&quot;bad&quot;</span>] );</span><br></pre></td></tr></table></figure>

<h1 id="色彩梯度"><a href="#色彩梯度" class="headerlink" title="色彩梯度"></a>色彩梯度</h1><p>代碼出處 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/colors.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/colors.js</a></p>
<img src="/2022/02/02/frontend-d3-008-color/01.png" class="" title="01.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo08_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear().domain( [<span class="number">0</span>,<span class="number">10</span>] ).range( [<span class="number">0</span>,<span class="number">300</span>] );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> sc1 = d3.scaleLinear().domain( [<span class="number">0</span>,<span class="number">3</span>,<span class="number">10</span>] ).range([<span class="string">&quot;blue&quot;</span>,<span class="string">&quot;white&quot;</span>,<span class="string">&quot;red&quot;</span>]);</span><br><span class="line">    <span class="keyword">var</span> sc2 = d3.scaleLinear().domain( [<span class="number">0</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">10</span>] )</span><br><span class="line">        .range( [<span class="string">&quot;white&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;white&quot;</span>] );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sc3 = d3.scaleSequential( <span class="function"><span class="params">t</span> =&gt;</span> <span class="string">&quot;&quot;</span> + d3.hsl( <span class="number">360</span>*t, <span class="number">1</span>, <span class="number">0.5</span> ) )</span><br><span class="line">        .domain( [<span class="number">0</span>, <span class="number">10</span>] );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sc4 = d3.scaleSequential( <span class="function"><span class="params">t</span> =&gt;</span> d3.interpolateSinebow(<span class="number">2</span>/<span class="number">3</span>-<span class="number">3</span>*t/<span class="number">4</span>) )</span><br><span class="line">        .domain( [<span class="number">0</span>, <span class="number">10</span>] );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sc5 = d3.scaleDiverging( <span class="function"><span class="params">t</span> =&gt;</span> d3.interpolateRdYlGn(<span class="number">1</span>-t) )</span><br><span class="line">	.domain( [<span class="number">0</span>, <span class="number">2</span>, <span class="number">10</span>] );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> sc6 = d3.scaleSequential( d3.interpolateRgbBasis(</span><br><span class="line">        [ <span class="string">&quot;#b2d899&quot;</span>, <span class="string">&quot;#ffffbf&quot;</span>, <span class="string">&quot;#bf9966&quot;</span>, <span class="string">&quot;#ffffff&quot;</span> ] ) ).domain( [<span class="number">0</span>, <span class="number">10</span>] );</span><br><span class="line">    </span><br><span class="line">    d3.select( <span class="string">&quot;#scale&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .call( colorbox, [ <span class="number">300</span>, <span class="number">30</span> ], sc1 )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(50,25)&quot;</span> );</span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;#scale&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .call( colorbox, [ <span class="number">300</span>, <span class="number">30</span> ], sc2 )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(50,75)&quot;</span> );</span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;#scale&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .call( colorbox, [ <span class="number">300</span>, <span class="number">30</span> ], sc3 )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(50,125)&quot;</span> );</span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;#scale&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .call( colorbox, [ <span class="number">300</span>, <span class="number">30</span> ], sc4 )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(50,175)&quot;</span> );</span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;#scale&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .call( colorbox, [ <span class="number">300</span>, <span class="number">30</span> ], sc5 )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(50,225)&quot;</span> );</span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;#scale&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .call( colorbox, [ <span class="number">300</span>, <span class="number">30</span> ], sc6, scX )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(50,275)&quot;</span> );   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorbox</span>(<span class="params"> sel, size, colors, ticks </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> [x0, x1] = d3.extent( colors.domain() );</span><br><span class="line">    <span class="keyword">var</span> bars = d3.range( x0, x1, (x1-x0)/size[<span class="number">0</span>] );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> sc = d3.scaleLinear().domain( [x0, x1] ).range( [<span class="number">0</span>, size[<span class="number">0</span>] ] );</span><br><span class="line">    sel.selectAll( <span class="string">&quot;line&quot;</span> ).data( bars ).enter().append( <span class="string">&quot;line&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;x1&quot;</span>, sc ).attr( <span class="string">&quot;x2&quot;</span>, sc )</span><br><span class="line">        .attr( <span class="string">&quot;y1&quot;</span>, <span class="number">0</span> ).attr( <span class="string">&quot;y2&quot;</span>, size[<span class="number">1</span>] )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, colors );</span><br><span class="line">    </span><br><span class="line">    sel.append( <span class="string">&quot;rect&quot;</span> ).attr( <span class="string">&quot;width&quot;</span>, size[<span class="number">0</span>] ).attr( <span class="string">&quot;height&quot;</span>, size[<span class="number">1</span>] )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;black&quot;</span> )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( ticks ) &#123;</span><br><span class="line">        sel.append( <span class="string">&quot;g&quot;</span> ).call( d3.axisBottom( ticks ) )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 0,&quot;</span> + size[<span class="number">1</span>] + <span class="string">&quot;)&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo08_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo08_1()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">&quot;scale&quot;</span> <span class="attr">height</span>=<span class="string">&quot;350&quot;</span> <span class="attr">width</span>=<span class="string">&quot;400&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo08_1;</span><br></pre></td></tr></table></figure>

<h1 id="熱點圖"><a href="#熱點圖" class="headerlink" title="熱點圖"></a>熱點圖</h1><p>代碼出處 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/colors.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/colors.js</a></p>
<img src="/2022/02/02/frontend-d3-008-color/02.png" class="" title="02.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo08_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cnv = d3.select( <span class="string">&quot;#canvas&quot;</span> );  <span class="comment">// 取得 HTML5 的 &lt;canvas&gt; 元素</span></span><br><span class="line">    <span class="keyword">var</span> ctx = cnv.node().getContext( <span class="string">&quot;2d&quot;</span> );  <span class="comment">// 先必須取得一個 2d 的 context 以供繪圖</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pxX = <span class="number">465</span>, pxY = <span class="number">250</span>;  <span class="comment">// 圖片像素大小</span></span><br><span class="line">    <span class="keyword">var</span> maxIter = <span class="number">2000</span>;  <span class="comment">// 曼德博集合的最大迭代次數，https://zh.wikipedia.org/wiki/%E6%9B%BC%E5%BE%B7%E5%8D%9A%E9%9B%86%E5%90%88</span></span><br><span class="line">    <span class="keyword">var</span> x0 = -<span class="number">1.31</span>, x1 = -<span class="number">0.845</span>, y0 = <span class="number">0.2</span>, y1 = <span class="number">0.45</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear().domain([<span class="number">0</span>, pxX]).range([x0, x1]);</span><br><span class="line">    <span class="keyword">var</span> scY = d3.scaleLinear().domain([<span class="number">0</span>, pxY]).range([y1, y0]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> scC = d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">10</span>,<span class="number">23</span>,<span class="number">35</span>,<span class="number">55</span>,<span class="number">1999</span>,<span class="number">2000</span>])</span><br><span class="line">        .range( [<span class="string">&quot;white&quot;</span>,<span class="string">&quot;red&quot;</span>,<span class="string">&quot;orange&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="string">&quot;lightyellow&quot;</span>,</span><br><span class="line">		 <span class="string">&quot;white&quot;</span>,<span class="string">&quot;darkgrey&quot;</span>] );</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">mandelbrot</span>(<span class="params"> x, y </span>) </span>&#123;  <span class="comment">// 曼德博公式</span></span><br><span class="line">        <span class="keyword">var</span> u=<span class="number">0.0</span>, v=<span class="number">0.0</span>, k=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>( k=<span class="number">0</span>; k&lt;maxIter &amp;&amp; (u*u + v*v)&lt;<span class="number">4</span>; k++ ) &#123;</span><br><span class="line">            <span class="keyword">var</span> t = u*u - v*v + x;</span><br><span class="line">            v = <span class="number">2</span>*u*v + y;</span><br><span class="line">            u = t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> k;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">var</span> j=<span class="number">0</span>; j&lt;pxY; j++ ) &#123;  <span class="comment">// 座標一點一點帶入取得顏色數值，並在畫布上畫出該座標點的顏色</span></span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>; i&lt;pxX; i++ ) &#123;</span><br><span class="line">            <span class="keyword">var</span> d = mandelbrot( scX(i), scY(j) );</span><br><span class="line">            ctx.fillStyle = scC( d );</span><br><span class="line">            ctx.fillRect( i, j, <span class="number">1</span>, <span class="number">1</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo08_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo08_2()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">height</span>=<span class="string">&quot;250&quot;</span> <span class="attr">width</span>=<span class="string">&quot;465&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo08_2;</span><br></pre></td></tr></table></figure>

<h1 id="輪廓線"><a href="#輪廓線" class="headerlink" title="輪廓線"></a>輪廓線</h1><ul>
<li>d3.contours() : 傳回一個輪廓線 layout 實例</li>
<li>conMkr( [data] ) : 為提供的資料集計算輪廓線，資料集必須為一維陣列，位置(i, j)的值，應該要被轉成一維陣列放在data[i+j*cols]上．會傳回一個 GeoJSON 物件陣列</li>
<li>conMkr.size( [cols, rows] ) : 設定欄和列的數目</li>
<li>conMkr.thresholds( args ) : 要被用於計算輪廓線的陣列值，如果是單一整數，則近似的 n 條輪廓線將會被計算</li>
<li>conMkr.contour( [data], threshold ) : 為提供的資料集在指定的臨界值上產生一條輪廓線<br>代碼出處 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/colors.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/colors.js</a><img src="/2022/02/02/frontend-d3-008-color/03.png" class="" title="03.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo08_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.json( <span class="string">&quot;data/haxby.json&quot;</span> ).then( drawContours );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawContours</span>(<span class="params"> scheme </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pxX = <span class="number">525</span>, pxY = <span class="number">300</span>;</span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear().domain([-<span class="number">3</span>, <span class="number">1</span>]).range([<span class="number">0</span>, pxX]);    </span><br><span class="line">    <span class="keyword">var</span> scY = d3.scaleLinear().domain([-<span class="number">1.5</span>, <span class="number">1.5</span>]).range([pxY, <span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">var</span> scC = d3.scaleSequential(</span><br><span class="line">        d3.interpolateRgbBasis(scheme[<span class="string">&quot;colors&quot;</span>]) ).domain([-<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">var</span> scZ = d3.scaleLinear().domain( [-<span class="number">1</span>, -<span class="number">0.25</span>, <span class="number">0.25</span>, <span class="number">1</span>] )         </span><br><span class="line">        .range( [ <span class="string">&quot;white&quot;</span>, <span class="string">&quot;grey&quot;</span>, <span class="string">&quot;grey&quot;</span>, <span class="string">&quot;black&quot;</span> ] );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> data = [];</span><br><span class="line">    <span class="keyword">var</span> f = <span class="function">(<span class="params">x, y, b</span>) =&gt;</span> (y**<span class="number">4</span> + x*y**<span class="number">2</span> + b*y)*<span class="built_in">Math</span>.exp(-(y**<span class="number">2</span>))  <span class="comment">// 使用此公式取得顏色數值</span></span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">var</span> j=<span class="number">0</span>; j&lt;pxY; j++ ) &#123;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>; i&lt;pxX; i++ ) &#123;</span><br><span class="line">            data.push( f( scX.invert(i), scY.invert(j), <span class="number">0.3</span> ) );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    console.log(data);</span></span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;#contours&quot;</span> ), g = svg.append( <span class="string">&quot;g&quot;</span> );</span><br><span class="line">    <span class="keyword">var</span> pathMkr = d3.geoPath();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> conMkr = d3.contours().size([pxX, pxY]).thresholds(<span class="number">100</span>);  <span class="comment">// 設定輪廓線，設定統計範圍 (pxX, pxY) 大小，data 依據 Sturges’ formula 將數值分組，組數近似於 100</span></span><br><span class="line"><span class="comment">//    console.log(conMkr(data));</span></span><br><span class="line">    g.append(<span class="string">&quot;g&quot;</span>).selectAll( <span class="string">&quot;path&quot;</span> ).data( conMkr(data) ).enter()</span><br><span class="line">        .append( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;d&quot;</span>, pathMkr )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scC(d.value) ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;none&quot;</span> )</span><br><span class="line">    </span><br><span class="line">    conMkr = d3.contours().size( [pxX,pxY] ).thresholds( <span class="number">10</span> );</span><br><span class="line">    g.append(<span class="string">&quot;g&quot;</span>).selectAll( <span class="string">&quot;path&quot;</span> ).data( conMkr(data) ).enter()</span><br><span class="line">        .append( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;d&quot;</span>, pathMkr )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scZ(d.value) );</span><br><span class="line">    </span><br><span class="line">    g.select( <span class="string">&quot;g&quot;</span> ).append( <span class="string">&quot;path&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;d&quot;</span>, pathMkr( conMkr.contour( data, <span class="number">0.025</span> ) ) )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">2</span> );</span><br><span class="line"></span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).call( d3.axisTop(scX).ticks(<span class="number">10</span>) )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(0,&quot;</span> + pxY + <span class="string">&quot;)&quot;</span> );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).call( d3.axisRight(scY).ticks(<span class="number">5</span>) );</span><br><span class="line"></span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).call( colorbox, [<span class="number">280</span>,<span class="number">30</span>], scC )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 540,290 ) rotate(-90)&quot;</span> )</span><br><span class="line">        .selectAll( <span class="string">&quot;text&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;rotate(90)&quot;</span> );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 570,10 )&quot;</span> )</span><br><span class="line">        .call( d3.axisRight( d3.scaleLinear()</span><br><span class="line">                             .domain( [-<span class="number">1</span>,<span class="number">1</span>] ).range( [<span class="number">280</span>,<span class="number">0</span>] ) ) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorbox</span>(<span class="params"> sel, size, colors, ticks </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> [x0, x1] = d3.extent( colors.domain() );</span><br><span class="line">    <span class="keyword">var</span> bars = d3.range( x0, x1, (x1-x0)/size[<span class="number">0</span>] );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> sc = d3.scaleLinear().domain( [x0, x1] ).range( [<span class="number">0</span>, size[<span class="number">0</span>] ] );</span><br><span class="line">    sel.selectAll( <span class="string">&quot;line&quot;</span> ).data( bars ).enter().append( <span class="string">&quot;line&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;x1&quot;</span>, sc ).attr( <span class="string">&quot;x2&quot;</span>, sc )</span><br><span class="line">        .attr( <span class="string">&quot;y1&quot;</span>, <span class="number">0</span> ).attr( <span class="string">&quot;y2&quot;</span>, size[<span class="number">1</span>] )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, colors );</span><br><span class="line">    </span><br><span class="line">    sel.append( <span class="string">&quot;rect&quot;</span> ).attr( <span class="string">&quot;width&quot;</span>, size[<span class="number">0</span>] ).attr( <span class="string">&quot;height&quot;</span>, size[<span class="number">1</span>] )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;black&quot;</span> )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( ticks ) &#123;</span><br><span class="line">        sel.append( <span class="string">&quot;g&quot;</span> ).call( d3.axisBottom( ticks ) )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 0,&quot;</span> + size[<span class="number">1</span>] + <span class="string">&quot;)&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo08_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo08_3()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">&quot;contours&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo08_3;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/01/frontend-d3-007-scale-axis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/01/frontend-d3-007-scale-axis/" class="post-title-link" itemprop="url">D3 - 007 Scale 和 Axis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-01 18:32:48" itemprop="dateCreated datePublished" datetime="2022-02-01T18:32:48+08:00">2022-02-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:14" itemprop="dateModified" datetime="2022-02-08T16:17:14+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>14 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Scale"><a href="#Scale" class="headerlink" title="Scale"></a>Scale</h1><h2 id="連續性的-Scale"><a href="#連續性的-Scale" class="headerlink" title="連續性的 Scale"></a>連續性的 Scale</h2><p>就是由一組數值對應到另一組數值，提供以下幾種 scale</p>
<ul>
<li>d3.scaleLinear()</li>
<li>d3.scalePow()</li>
<li>d3.scaleSqrt()</li>
<li>d3.scaleLog()</li>
<li>d3.scaleTime()</li>
<li>d3.scaleUtc()<br>連續性 Scale 具有的方法</li>
<li>sc( x ) : 輸入一個在 Domain 上的數值 ( x )，返回一個在 Range 上的值</li>
<li>sc.invert( y ) : 輸入一個在 Range 上的數值 ( y )，返回一個在 Domain 上的值</li>
<li>sc.domain( [invalues] ) : 設定 Doamin </li>
<li>sc.range( [outvalues] ) : 設定 Range</li>
<li>sc.clamp( boolean ) : 若啟用 clamping 則傳回的職會被限定在 range 中</li>
<li>sc.ticks( count ) : 傳回相等間隔的陣列，會從 Domain 上切割成 count 等份</li>
<li>sc.tickFormat( count, format ) : 以 format 物件格式化傳回的陣列</li>
<li>sc.nice( count ) : 延伸 Domain，使其裁切更好</li>
<li>sc.copy() : 傳回目前 scale 的複本</li>
</ul>
<h2 id="自訂-scale"><a href="#自訂-scale" class="headerlink" title="自訂 scale"></a>自訂 scale</h2><p>可編寫自己的映射函數</p>
<ul>
<li>d3.scaleSequential( interpolator )</li>
<li>d3.scaleDiverging( interpolator )</li>
</ul>
<h2 id="分箱-Scale"><a href="#分箱-Scale" class="headerlink" title="分箱 Scale"></a>分箱 Scale</h2><p>用來對應一組連續數值到一組離散的箱子</p>
<ul>
<li>d3.scaleQuantize() : 以輸入域分箱</li>
<li>d3.scaleThreshold() : 以臨界值分箱</li>
<li>d3.scaleQuantile() : 以資料集中度分箱<img src="/2022/02/01/frontend-d3-007-scale-axis/01.png" class="" title="01.png">
引入一個 svg 檔<br>public/data/ch7.svg<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">xmlns:svg</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;quantize&quot;</span> <span class="attr">transform</span>=<span class="string">&quot;translate(25,10)&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;75&quot;</span> <span class="attr">y</span>=<span class="string">&quot;25&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span>&gt;</span>d3.scaleQuantize()<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;115&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;115&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;120&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;110&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;120&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;110&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;19&quot;</span>  <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;69&quot;</span>  <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;119&quot;</span> <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;50&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;125&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;3 3&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;125&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;3 3&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;75&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span>&gt;</span>Equally sized bins<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;threshold&quot;</span> <span class="attr">transform</span>=<span class="string">&quot;translate(225,10)&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;75&quot;</span> <span class="attr">y</span>=<span class="string">&quot;25&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span>&gt;</span>d3.scaleThreshold()<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;115&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;115&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;120&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;110&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;120&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;110&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span>	</span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;14&quot;</span>  <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;49&quot;</span>  <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;104&quot;</span> <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;40&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;125&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;40&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;3 3&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;70&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;125&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;70&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;3 3&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">&quot;40,115 45,130 35,130&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">&quot;70,115 75,130 65,130&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;75&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span>&gt;</span>Explicit thresholds<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;quantile&quot;</span> <span class="attr">transform</span>=<span class="string">&quot;translate(425,10)&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;75&quot;</span> <span class="attr">y</span>=<span class="string">&quot;25&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span>&gt;</span>d3.scaleQuantile()<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;115&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;115&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;120&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;110&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;120&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;150&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;110&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">id</span>=<span class="string">&quot;bin1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;19&quot;</span>  <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">id</span>=<span class="string">&quot;bin2&quot;</span> <span class="attr">x</span>=<span class="string">&quot;69&quot;</span>  <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rect</span> <span class="attr">id</span>=<span class="string">&quot;bin2&quot;</span> <span class="attr">x</span>=<span class="string">&quot;119&quot;</span> <span class="attr">y</span>=<span class="string">&quot;60&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12&quot;</span> <span class="attr">height</span>=<span class="string">&quot;12&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;blue&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">id</span>=<span class="string">&quot;bd1&quot;</span> <span class="attr">x1</span>=<span class="string">&quot;50&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;125&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;3 3&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">line</span> <span class="attr">id</span>=<span class="string">&quot;bd2&quot;</span> <span class="attr">x1</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;125&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;50&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;3 3&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;75&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span>&gt;</span>Implicit thresholds<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;75&quot;</span> <span class="attr">y</span>=<span class="string">&quot;170&quot;</span> <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span> <span class="attr">font-family</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">font-size</span>=<span class="string">&quot;14&quot;</span>&gt;</span>Equally populated bins<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo07_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> gauss = d3.randomNormal( <span class="number">75</span>, <span class="number">40</span> );</span><br><span class="line">    <span class="keyword">var</span> uni = d3.randomUniform( <span class="number">2</span>, <span class="number">10</span> );</span><br><span class="line">    <span class="keyword">var</span> data = [];</span><br><span class="line">    <span class="keyword">for</span>( ; data.length &lt; <span class="number">50</span> ; ) &#123;</span><br><span class="line">	    <span class="keyword">var</span> g = gauss();</span><br><span class="line">	    <span class="keyword">if</span>( g &gt; <span class="number">0</span> &amp;&amp; g &lt; <span class="number">150</span> ) &#123;</span><br><span class="line">	        data.push( g )</span><br><span class="line">	    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> sc = d3.scaleQuantile().domain(data).range( [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] );</span><br><span class="line"><span class="comment">//    console.log( sc.invertExtent(1), sc.invertExtent(2), sc.invertExtent(3) );</span></span><br><span class="line">    </span><br><span class="line">    d3.select( <span class="string">&quot;#quantile&quot;</span> ).selectAll( <span class="string">&quot;circle&quot;</span> ).data(data).enter()</span><br><span class="line">	.append( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;r&quot;</span>, <span class="number">2</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span> )</span><br><span class="line">	.attr( <span class="string">&quot;cy&quot;</span>, <span class="function">()=&gt;</span><span class="number">115</span>+uni() ).attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d );</span><br><span class="line">    d3.select( <span class="string">&quot;#bd1&quot;</span> )</span><br><span class="line">	.attr( <span class="string">&quot;x1&quot;</span>, sc.invertExtent(<span class="number">1</span>)[<span class="number">1</span>] )</span><br><span class="line">	.attr( <span class="string">&quot;x2&quot;</span>, sc.invertExtent(<span class="number">1</span>)[<span class="number">1</span>] );</span><br><span class="line">    d3.select( <span class="string">&quot;#bd2&quot;</span> )</span><br><span class="line">	.attr( <span class="string">&quot;x1&quot;</span>, sc.invertExtent(<span class="number">2</span>)[<span class="number">1</span>] )</span><br><span class="line">	.attr( <span class="string">&quot;x2&quot;</span>, sc.invertExtent(<span class="number">2</span>)[<span class="number">1</span>] );</span><br><span class="line">    d3.select( <span class="string">&quot;#bin1&quot;</span> ).attr( <span class="string">&quot;x&quot;</span>, d3.mean(sc.invertExtent(<span class="number">1</span>))-<span class="number">6</span> );</span><br><span class="line">    d3.select( <span class="string">&quot;#bin2&quot;</span> ).attr( <span class="string">&quot;x&quot;</span>, d3.mean(sc.invertExtent(<span class="number">2</span>))-<span class="number">6</span> );</span><br><span class="line">    d3.select( <span class="string">&quot;#bin3&quot;</span> ).attr( <span class="string">&quot;x&quot;</span>, d3.mean(sc.invertExtent(<span class="number">3</span>))-<span class="number">6</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readSvg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// svg</span></span><br><span class="line">    d3.svg( <span class="string">&quot;data/ch7.svg&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        d3.select( <span class="string">&quot;svg&quot;</span> ).insert( <span class="function">()=&gt;</span>res.firstChild, <span class="string">&quot;:first-child&quot;</span> );</span><br><span class="line">        d3.select( <span class="string">&quot;#test&quot;</span> ).append( <span class="string">&quot;use&quot;</span> ).attr( <span class="string">&quot;href&quot;</span>, <span class="string">&quot;#quantize&quot;</span> );</span><br><span class="line">        d3.select( <span class="string">&quot;#test&quot;</span> ).append( <span class="string">&quot;use&quot;</span> ).attr( <span class="string">&quot;href&quot;</span>, <span class="string">&quot;#threshold&quot;</span>);</span><br><span class="line">        d3.select( <span class="string">&quot;#test&quot;</span> ).append( <span class="string">&quot;use&quot;</span> ).attr( <span class="string">&quot;href&quot;</span>, <span class="string">&quot;#quantile&quot;</span>);</span><br><span class="line">        makeDemo07_1()</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo07_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        readSvg()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo07_1;</span><br></pre></td></tr></table></figure>
分箱 Scale 具有的方法</li>
<li>sc( x ) : 輸入一個在 Domain 上的數值 ( x )，返回一個在 Range 上的值</li>
<li>sc.invertExtent( y ) : 輸入一個在 Range 上的數值 ( y )，在 Domain 的範圍內，返回一個 2 元素的陣列，代表對應箱子的邊界值</li>
<li>sc.domain( [invalues] ) : 設定 Doamin </li>
<li>sc.range( [outvalues] ) : 設定 Range</li>
<li>sc.copy() : 傳回目前 scale 的複本</li>
</ul>
<h2 id="離散式-Scale"><a href="#離散式-Scale" class="headerlink" title="離散式 Scale"></a>離散式 Scale</h2><p>用來把一組離散值對應到令一組離散值</p>
<ul>
<li>d3.scaleOrdinal( [outvalues] )</li>
<li>d3.scalePoint()</li>
<li>d3.scaleBand()<br>離散 Scale 具有的方法</li>
<li>sc( x ) : 輸入一個在 Domain 上的數值 ( x )，返回一個在 Range 上的值</li>
<li>sc.domain( [invalues] ) : 設定 Doamin </li>
<li>sc.range( [outvalues] ) : 設定 Range</li>
<li>sc.unknown( value ) : 為未知的輸入設定其輸出值</li>
<li>sc.copy() : 傳回目前 scale 的複本</li>
</ul>
<h1 id="Axis"><a href="#Axis" class="headerlink" title="Axis"></a>Axis</h1><p>軸的基本組成，由一條直線標示軸 (&lt;path&gt;)，還有一組刻度 (&lt;line&gt;) 與標籤 (&lt;text&gt;)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">&quot;domain&quot;</span> <span class="attr">d</span>=<span class="string">&quot;...&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">g</span> <span class="attr">class</span>=<span class="string">&quot;tick&quot;</span> <span class="attr">transform</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">line</span> <span class="attr">...</span>&gt;</span><span class="tag">&lt;/<span class="name">line</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">...</span>&gt;</span>1<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">line</span> <span class="attr">...</span>&gt;</span><span class="tag">&lt;/<span class="name">line</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">...</span>&gt;</span>2<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>軸的基本建構流程</p>
<ol>
<li>實體化一個 Scale 物件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sc = d3.scaleLinear();</span><br></pre></td></tr></table></figure></li>
<li>實體化一個 axis 組件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> axMkr = d3.axisBottom( sc );</span><br></pre></td></tr></table></figure></li>
<li>提供一個合適的 &lt;g&gt; 元素並把它移到目標位置<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g = d3.select( ... ).append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, ... );</span><br></pre></td></tr></table></figure></li>
<li>以 &lt;g&gt; 元素作為參數傳給 axis 組件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axMkr( g );</span><br></pre></td></tr></table></figure>
亦可以使用<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.select( ... ).append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, ... ).call( axMkr );</span><br></pre></td></tr></table></figure>
軸相關方法</li>
</ol>
<ul>
<li>d3.axisTop(scale ) : 傳回一個軸的實例，預設刻度大小為 6，預設的空白填充是 3，刻度與標籤位於軸的上方．</li>
<li>d3.axisBottom(scale ) : 傳回一個軸的實例，預設刻度大小為 6，預設的空白填充是 3，刻度與標籤位於軸的下方．</li>
<li>d3.axisLeft(scale ) : 傳回一個軸的實例，預設刻度大小為 6，預設的空白填充是 3，刻度與標籤位於軸的左方．</li>
<li>d3.axisRight(scale ) : 傳回一個軸的實例，預設刻度大小為 6，預設的空白填充是 3，刻度與標籤位於軸的右方．</li>
<li>axMkr( selection ) : selection 必須為 &lt;svg&gt; 或 &lt;g&gt;，若 selection 包含多個節點，則每個節點都會建立一個軸</li>
<li>axMkr.scale( scale ) : 設定 scale 物件</li>
</ul>
<h1 id="自訂刻度與標籤"><a href="#自訂刻度與標籤" class="headerlink" title="自訂刻度與標籤"></a>自訂刻度與標籤</h1><ul>
<li>axMkr.ticks( t, fmt ) : </li>
<li>axMkr.tickValues( [values] ) : 提供一組數值陣列，以取代掉 scale 所算出的，使用 null 可以清除之前的設定</li>
<li>axMkr.tickFormat( format ) : 傳入一個 formatter 實例用於格式化刻度標籤</li>
<li>axMkr.tickSize( size ) : 預設為 6，同時設定內部與外部刻度記號的數量</li>
<li>axMkr.tickSizeInner( size ) : 預設為 6，同時設定內部刻度記號的數量</li>
<li>axMkr.tickSizeOuter( size ) : 預設為 6，同時設定外部刻度記號的數量</li>
<li>axMkr.tickPadding( size ) : 預設為 3，設定刻度記號和刻度標籤之間的填充距離<img src="/2022/02/01/frontend-d3-007-scale-axis/02.png" class="" title="02.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo07_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sc = d3.scaleLinear().domain( [<span class="number">0</span>,<span class="number">10</span>] ).range( [<span class="number">0</span>,<span class="number">200</span>] );  <span class="comment">// 輸入區間為 0 ~ 10，輸出像素範圍為 0 ~ 200</span></span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 50,50)&quot;</span> )</span><br><span class="line">        .call( d3.axisBottom(sc) );</span><br><span class="line">    </span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 50,125)&quot;</span> )</span><br><span class="line">        .call( d3.axisBottom(sc).tickFormat( d3.format(<span class="string">&quot;.1f&quot;</span>) ) )  <span class="comment">// 刻度格式取小數點後一位</span></span><br><span class="line">        .selectAll( <span class="string">&quot;text&quot;</span> )</span><br><span class="line">        .filter( <span class="function">(<span class="params">d,i</span>)=&gt;</span>i%<span class="number">2</span>!=<span class="number">0</span> ).attr( <span class="string">&quot;visibility&quot;</span>, <span class="string">&quot;hidden&quot;</span> );  <span class="comment">// 偶數刻度才顯示</span></span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(350,50)&quot;</span> )</span><br><span class="line">        .call( d3.axisBottom(sc).tickFormat( <span class="function">()=&gt;</span><span class="string">&quot;&quot;</span> ) );  <span class="comment">// 消除刻度標籤</span></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(350,50)&quot;</span> )</span><br><span class="line">        .call( d3.axisBottom( sc ).ticks(<span class="number">2</span>) )  <span class="comment">// 分隔成 2 等份</span></span><br><span class="line">        .append( <span class="string">&quot;text&quot;</span> ).text( <span class="string">&quot;Metric&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, sc(<span class="number">5</span>) ).attr(<span class="string">&quot;y&quot;</span>, <span class="number">35</span> )</span><br><span class="line">        .attr( <span class="string">&quot;font-size&quot;</span>, <span class="number">12</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;black&quot;</span> );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(350,125)&quot;</span> )</span><br><span class="line">        .call( d3.axisBottom(sc).tickPadding( <span class="number">5</span> ) );</span><br><span class="line">    g.select( <span class="string">&quot;.domain&quot;</span> ).attr( <span class="string">&quot;visibility&quot;</span>, <span class="string">&quot;hidden&quot;</span> );  <span class="comment">// 隱藏軸線</span></span><br><span class="line">    g.selectAll( <span class="string">&quot;.tick&quot;</span> ).select( <span class="string">&quot;line&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">2</span> );  <span class="comment">// 改變刻度記號</span></span><br><span class="line">    g.selectAll( <span class="string">&quot;text&quot;</span> ).attr( <span class="string">&quot;font-size&quot;</span>, <span class="number">14</span> );  <span class="comment">// 改變刻度標籤</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo07_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo07_2()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo07_2;</span><br></pre></td></tr></table></figure>
參考代碼 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/scales.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/scales.js</a></li>
</ul>
<h1 id="範例-1"><a href="#範例-1" class="headerlink" title="範例 1"></a>範例 1</h1><p>參考代碼 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/scales.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/scales.js</a></p>
<img src="/2022/02/01/frontend-d3-007-scale-axis/03.png" class="" title="03.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo07_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.text( <span class="string">&quot;data/cost.csv&quot;</span> ).then( <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> data = d3.csvParseRows( res, <span class="function"><span class="params">d</span> =&gt;</span> [ +d[<span class="number">0</span>], +d[<span class="number">1</span>] ] );  <span class="comment">// 讀取資料</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"> sel, scX, scY, width, height </span>) </span>&#123; <span class="comment">// 繪製線圖函數</span></span><br><span class="line">            scX = scX.domain( d3.extent( data, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>] ) ).nice()  <span class="comment">// extent() 算出最大及最小值</span></span><br><span class="line">                .range( [ <span class="number">0</span>, width ] );</span><br><span class="line">            scY = scY.domain( d3.extent( data, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>] ) ).nice()</span><br><span class="line">                .range( [ height, <span class="number">0</span> ]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> ds = data.map( <span class="function"><span class="params">d</span>=&gt;</span>[ scX(d[<span class="number">0</span>]), scY(d[<span class="number">1</span>]) ] );  <span class="comment">// 導入資料集</span></span><br><span class="line">            sel.append( <span class="string">&quot;path&quot;</span> ).classed( <span class="string">&quot;curve&quot;</span>, <span class="literal">true</span> )  <span class="comment">// 設定 &lt;path&gt; 的 calss name 為 curve</span></span><br><span class="line">                .attr( <span class="string">&quot;d&quot;</span>, d3.line()(ds) ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> )  <span class="comment">// 使用 line 產生器依據資料集 ds 繪製一條直線</span></span><br><span class="line"></span><br><span class="line">            sel.append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">                .call( d3.axisBottom( scX ).ticks(<span class="number">10</span>, <span class="string">&quot;d&quot;</span>) )  <span class="comment">// 分成 10 等份，而刻度標籤格式為整數</span></span><br><span class="line">                .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 0,&quot;</span>+height+<span class="string">&quot;)&quot;</span> );</span><br><span class="line">            </span><br><span class="line">            sel.append( <span class="string">&quot;g&quot;</span> ).call( d3.axisLeft( scY ) );</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 50, 50 )&quot;</span> )</span><br><span class="line">            .call( draw,d3.scaleLinear(),d3.scaleLinear(),<span class="number">500</span>,<span class="number">500</span> )</span><br><span class="line">            .select( <span class="string">&quot;.curve&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> );</span><br><span class="line">           </span><br><span class="line">        d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">            .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 200, 50 )&quot;</span> )</span><br><span class="line">            .call( draw,d3.scaleLinear(),d3.scaleLog(),<span class="number">350</span>,<span class="number">250</span> )</span><br><span class="line">            .select( <span class="string">&quot;.curve&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;blue&quot;</span> );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo07_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo07_3()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo07_3;</span><br></pre></td></tr></table></figure>

<h1 id="範例-2"><a href="#範例-2" class="headerlink" title="範例 2"></a>範例 2</h1><p>參考代碼 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/scales.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/scales.js</a></p>
<img src="/2022/02/01/frontend-d3-007-scale-axis/04.png" class="" title="04.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo07_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.text( <span class="string">&quot;data/load.csv&quot;</span> ).then( <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// prepare data</span></span><br><span class="line">        <span class="keyword">var</span> parse = d3.utcParse( <span class="string">&quot;%H:%M:%S&quot;</span> );  <span class="comment">// 建立剖析時間戳的函數</span></span><br><span class="line">        <span class="keyword">var</span> format = d3.utcFormat( <span class="string">&quot;%H:%M&quot;</span> );  <span class="comment">// 建立格式化時間戳的函數</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> data = d3.csvParse( res, <span class="function"><span class="keyword">function</span>(<span class="params"> d </span>) </span>&#123;  <span class="comment">// 讀取資料</span></span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">ts</span>: parse(d.timestamp), <span class="attr">val</span>: +d.load &#125;</span><br><span class="line">        &#125; );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> scT = d3.scaleUtc()</span><br><span class="line">            .domain( d3.extent( data, <span class="function"><span class="params">d</span>=&gt;</span>d.ts ) ).nice()</span><br><span class="line">            .range( [ <span class="number">50</span>, <span class="number">550</span> ] );</span><br><span class="line">        <span class="keyword">var</span> scY = d3.scaleLinear()</span><br><span class="line">            .domain( [<span class="number">0</span>, <span class="number">100</span>] ).range( [ <span class="number">250</span>, <span class="number">50</span> ] );</span><br><span class="line">        <span class="keyword">var</span> scC = d3.scaleThreshold()  <span class="comment">// 建立用臨界值方式建立 scale ( 小於 35: green, 35-75: orange, 大於 75 : red )</span></span><br><span class="line">            .domain( [<span class="number">35</span>, <span class="number">75</span>] ).range( [<span class="string">&quot;green&quot;</span>,<span class="string">&quot;orange&quot;</span>,<span class="string">&quot;red&quot;</span>] );</span><br><span class="line">        </span><br><span class="line">        data = d3.pairs( data, <span class="function">(<span class="params">a,b</span>) =&gt;</span> &#123; <span class="keyword">return</span> &#123; <span class="attr">src</span>: a, <span class="attr">dst</span>: b &#125; &#125; );  <span class="comment">// 將一點一點的陣列，轉成具有起點與終點的線段對</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> ).attr( <span class="string">&quot;cursor&quot;</span>,<span class="string">&quot;crosshair&quot;</span> );</span><br><span class="line">        </span><br><span class="line">        svg.selectAll(<span class="string">&quot;line&quot;</span>).data(data).enter().append(<span class="string">&quot;line&quot;</span>)  <span class="comment">// 不同於之前使用 D3 的 line 產生器，此種曲線必須自己客製化</span></span><br><span class="line">            .attr( <span class="string">&quot;x1&quot;</span>, <span class="function"><span class="params">d</span> =&gt;</span> scT(d.src.ts) ) </span><br><span class="line">            .attr( <span class="string">&quot;x2&quot;</span>, <span class="function"><span class="params">d</span> =&gt;</span> scT(d.dst.ts) )</span><br><span class="line">            .attr( <span class="string">&quot;y1&quot;</span>, <span class="function"><span class="params">d</span> =&gt;</span> scY(d.src.val) )</span><br><span class="line">            .attr( <span class="string">&quot;y2&quot;</span>, <span class="function"><span class="params">d</span> =&gt;</span> scY(d.dst.val) )</span><br><span class="line">            .attr( <span class="string">&quot;stroke&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scC( (d.src.val + d.dst.val)/<span class="number">2</span> ) );</span><br><span class="line"></span><br><span class="line">        svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(50,0)&quot;</span> )</span><br><span class="line">            .call( d3.axisLeft(scY) );</span><br><span class="line">        svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(0,250)&quot;</span> )        </span><br><span class="line">            .call( d3.axisBottom(scT).tickFormat( format )</span><br><span class="line">                   .ticks( d3.utcMinute.every(<span class="number">10</span>) ) );  <span class="comment">// 以每 10 分鐘為一個刻度</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 製作滑動鼠標而顯示曲線數值</span></span><br><span class="line">        <span class="keyword">var</span> txt = svg.append(<span class="string">&quot;text&quot;</span>).attr(<span class="string">&quot;x&quot;</span>,<span class="number">100</span>).attr(<span class="string">&quot;y&quot;</span>,<span class="number">50</span>)   <span class="comment">// 定義數值顯示位置</span></span><br><span class="line">            .attr(<span class="string">&quot;font-family&quot;</span>,<span class="string">&quot;sans-serif&quot;</span>).attr(<span class="string">&quot;font-size&quot;</span>,<span class="number">14</span>);</span><br><span class="line">        svg.on( <span class="string">&quot;mousemove&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pt = d3.pointer( event, svg.node() )</span><br><span class="line">            txt.text( format( scT.invert( pt[<span class="number">0</span>] ) ) + <span class="string">&quot; | &quot;</span> +     <span class="comment">// 依據滑鼠 x 座標反算 x 軸的數值</span></span><br><span class="line">                      d3.format( <span class="string">&quot;&gt;2d&quot;</span> )( scY.invert(pt[<span class="number">1</span>]) ) );  <span class="comment">// 依據滑鼠 y 座標反算 y 軸的數值</span></span><br><span class="line">        &#125; );    </span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo07_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo07_4()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo07_4;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/01/frontend-d3-006-data-io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/01/frontend-d3-006-data-io/" class="post-title-link" itemprop="url">D3 - 006 讀取資料</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-01 15:53:32" itemprop="dateCreated datePublished" datetime="2022-02-01T15:53:32+08:00">2022-02-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:14" itemprop="dateModified" datetime="2022-02-08T16:17:14+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="擷取資料的方法"><a href="#擷取資料的方法" class="headerlink" title="擷取資料的方法"></a>擷取資料的方法</h1><ul>
<li>d3.text( url, init ) : 由 url 讀取，並剖析傳回一個 UTF-8 字串</li>
<li>d3.json( url, init ) : 由 url 讀取，並照JSON 格式剖析傳回一個物件</li>
<li>d3.dsv( delimiter, url, init converter ) : 由 url 讀取，依據分隔符是 delimiter 分隔剖析傳回一個物件陣列</li>
<li>d3.csv( url, init, converter ) : 由 url 讀取，讀取一個具有標頭的 csv 檔，分隔符是逗號，傳回一個物件陣列</li>
<li>d3.tsc( url, init, converter ) : 由 url 讀取，讀取一個具有標頭的 tsv 檔，分隔符是定位符號，傳回一個物件陣列</li>
<li>d3.html( url, init ) : 由 url 讀取，讀取資料並剖析為 HTMLDocument 元素</li>
<li>d3.svg( url, init ) : 由 url 讀取，讀取資料並剖析為 SVGDocument 元素</li>
<li>d3.xml( url, init ) : 由 url 讀取，讀取資料並剖析為 Document 元素</li>
<li>d3.image( url, init ) : 由 url 讀取，讀取資料並剖析為 HTMLImageElement 元素</li>
<li>d3.blob( url, init ) : 由 url 讀取，讀取資料並剖析為 Blob 物件</li>
<li>d3.buffer( url, init ) : 由 url 讀取，讀取資料並剖析為 ArrayBuffer 物件</li>
</ul>
<p>範例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// json</span></span><br><span class="line">    d3.json( <span class="string">&quot;data/simple.json&quot;</span> ).then( </span><br><span class="line">        <span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log( res.val, res.txt ) </span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readImage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// image</span></span><br><span class="line">    d3.image( <span class="string">&quot;data/image.jpg&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    	d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="function">() =&gt;</span> res ) </span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readSvg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// svg</span></span><br><span class="line">    d3.svg( <span class="string">&quot;data/heart.svg&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        d3.select( <span class="string">&quot;svg&quot;</span> ).insert( <span class="function">()=&gt;</span>res.firstChild, <span class="string">&quot;:first-child&quot;</span> );</span><br><span class="line">        d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;use&quot;</span> ).attr( <span class="string">&quot;href&quot;</span>, <span class="string">&quot;#heart&quot;</span> )</span><br><span class="line">                .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(100,100) scale(2)&quot;</span> );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readCsv</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// csv</span></span><br><span class="line">    d3.text( <span class="string">&quot;data/csv.csv&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = d3.csvParse( res, <span class="function">(<span class="params">d,i,cs</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>( d.Year, d.Month-<span class="number">1</span> ),</span><br><span class="line">                <span class="attr">name</span>: d.Name,</span><br><span class="line">                <span class="attr">weight</span>: +d[<span class="string">&quot;Weight (kg)&quot;</span>]</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125; );</span><br><span class="line">        <span class="built_in">console</span>.log( data );                             </span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readAndParse</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// more csv</span></span><br><span class="line">    d3.csv( <span class="string">&quot;data/csv.csv&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        data = res;</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">&quot;1&quot;</span>, data );</span><br><span class="line">    &#125; );</span><br><span class="line"></span><br><span class="line">    d3.text( <span class="string">&quot;data/csv.csv&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        data = d3.csvParse( res );</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">&quot;2&quot;</span>, data );</span><br><span class="line">    &#125; );</span><br><span class="line">    </span><br><span class="line">    d3.text( <span class="string">&quot;data/csv.csv&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parser = d3.dsvFormat( <span class="string">&quot;,&quot;</span> );</span><br><span class="line">        data = parser.parse( res );</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">&quot;3&quot;</span>, data );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readAndParseWhiteSpace</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// general whitespace</span></span><br><span class="line">    d3.text( <span class="string">&quot;data/txt.txt&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parser = d3.dsvFormat( <span class="string">&quot;&quot;</span> ) <span class="comment">// ( &quot;\0&quot; );</span></span><br><span class="line">        <span class="keyword">var</span> rows = parser.parseRows( res, <span class="function"><span class="keyword">function</span>(<span class="params">d, i, cs</span>) </span>&#123;     </span><br><span class="line">                <span class="keyword">return</span> d[<span class="number">0</span>].split( <span class="regexp">/\s+/g</span> ).map( <span class="function"><span class="params">x</span> =&gt;</span> +x );            <span class="comment">// &lt;3&gt; &lt;4&gt;</span></span><br><span class="line">        &#125; );</span><br><span class="line">        <span class="built_in">console</span>.log( rows );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">numberFormatting</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// number formatting</span></span><br><span class="line">    d3.json( <span class="string">&quot;https://unpkg.com/d3-format/locale/de-DE.json&quot;</span> ).then(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"> res </span>) </span>&#123;           </span><br><span class="line">                <span class="keyword">var</span> loc = d3.formatLocale( res );</span><br><span class="line">                <span class="built_in">console</span>.log( loc.format( <span class="string">&quot;.4f&quot;</span> )( <span class="built_in">Math</span>.PI ) );</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"> err </span>) </span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> err;</span><br><span class="line">        &#125;</span><br><span class="line">    );    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo06_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//    readJson()</span></span><br><span class="line"><span class="comment">//    readImage()</span></span><br><span class="line"><span class="comment">//    readSvg()</span></span><br><span class="line"><span class="comment">//    readCsv()</span></span><br><span class="line"><span class="comment">//    readAndParse()</span></span><br><span class="line"><span class="comment">//    readAndParseWhiteSpace()</span></span><br><span class="line">    numberFormatting()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo06_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo06_1()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo06_1;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/30/frontend-d3-005-draw-shape/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/30/frontend-d3-005-draw-shape/" class="post-title-link" itemprop="url">D3 - 005 圖形與組件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-30 18:31:20" itemprop="dateCreated datePublished" datetime="2022-01-30T18:31:20+08:00">2022-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:14" itemprop="dateModified" datetime="2022-02-08T16:17:14+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>17 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="D3-內建的符號"><a href="#D3-內建的符號" class="headerlink" title="D3 內建的符號"></a>D3 內建的符號</h1><img src="/2022/01/30/frontend-d3-005-draw-shape/01.png" class="" title="01.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = [ </span><br><span class="line">        &#123; <span class="string">&quot;x&quot;</span>: <span class="number">20</span>, <span class="string">&quot;y&quot;</span>:  <span class="number">40</span>, <span class="string">&quot;size&quot;</span>: <span class="number">100</span>, <span class="string">&quot;symbol&quot;</span>: d3.symbolCircle, <span class="string">&quot;shape&quot;</span>: <span class="string">&quot;Circle&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;x&quot;</span>: <span class="number">20</span>, <span class="string">&quot;y&quot;</span>:  <span class="number">80</span>, <span class="string">&quot;size&quot;</span>: <span class="number">100</span>, <span class="string">&quot;symbol&quot;</span>: d3.symbolCross, <span class="string">&quot;shape&quot;</span>: <span class="string">&quot;Cross&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;x&quot;</span>: <span class="number">20</span>, <span class="string">&quot;y&quot;</span>: <span class="number">120</span>, <span class="string">&quot;size&quot;</span>: <span class="number">100</span>, <span class="string">&quot;symbol&quot;</span>: d3.symbolDiamond, <span class="string">&quot;shape&quot;</span>: <span class="string">&quot;Diamond&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;x&quot;</span>: <span class="number">20</span>, <span class="string">&quot;y&quot;</span>: <span class="number">160</span>, <span class="string">&quot;size&quot;</span>: <span class="number">100</span>, <span class="string">&quot;symbol&quot;</span>: d3.symbolSquare, <span class="string">&quot;shape&quot;</span>: <span class="string">&quot;Square&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;x&quot;</span>: <span class="number">20</span>, <span class="string">&quot;y&quot;</span>: <span class="number">200</span>, <span class="string">&quot;size&quot;</span>: <span class="number">100</span>, <span class="string">&quot;symbol&quot;</span>: d3.symbolStar, <span class="string">&quot;shape&quot;</span>: <span class="string">&quot;Star&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;x&quot;</span>: <span class="number">20</span>, <span class="string">&quot;y&quot;</span>: <span class="number">240</span>, <span class="string">&quot;size&quot;</span>: <span class="number">100</span>, <span class="string">&quot;symbol&quot;</span>: d3.symbolTriangle, <span class="string">&quot;shape&quot;</span>: <span class="string">&quot;Triangle&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;x&quot;</span>: <span class="number">20</span>, <span class="string">&quot;y&quot;</span>: <span class="number">280</span>, <span class="string">&quot;size&quot;</span>: <span class="number">100</span>, <span class="string">&quot;symbol&quot;</span>: d3.symbolWye, <span class="string">&quot;shape&quot;</span>: <span class="string">&quot;Wye&quot;</span> &#125; ]</span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line"></span><br><span class="line">    svg.selectAll( <span class="string">&quot;path&quot;</span> ).data(data).enter().append( <span class="string">&quot;path&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;d&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d3.symbol().size(d[<span class="string">&#x27;size&#x27;</span>]).type(d[<span class="string">&#x27;symbol&#x27;</span>])() )  <span class="comment">// 設定到 path 的 d 屬性以顯示</span></span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>,  <span class="comment">// 一開始都是畫在左上角的原點，所以需要將他移到適當的位置</span></span><br><span class="line">               <span class="function"><span class="params">d</span>=&gt;</span><span class="string">&quot;translate(&quot;</span> + d[<span class="string">&quot;x&quot;</span>] + <span class="string">&quot;,&quot;</span> + d[<span class="string">&quot;y&quot;</span>] + <span class="string">&quot;)&quot;</span> );</span><br><span class="line">    svg.selectAll(<span class="string">&quot;text&quot;</span>).data(data).enter().append(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .text(<span class="function"><span class="params">d</span>=&gt;</span>d[<span class="string">&quot;shape&quot;</span>])</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;blue&quot;</span>)</span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>+d[<span class="string">&#x27;x&#x27;</span>]+<span class="number">30</span>).attr( <span class="string">&quot;y&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>+d[<span class="string">&#x27;y&#x27;</span>]+<span class="number">7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          makeDemo05_1()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;320&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">lightgrey</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_1;</span><br></pre></td></tr></table></figure>

<h1 id="自訂符號"><a href="#自訂符號" class="headerlink" title="自訂符號"></a>自訂符號</h1><img src="/2022/01/30/frontend-d3-005-draw-shape/02.png" class="" title="02.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = [&#123;<span class="string">&quot;x&quot;</span>: <span class="number">30</span>, <span class="string">&quot;y&quot;</span>: <span class="number">30</span>&#125;]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">arrow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;M0 0 L32 0 M16 8 L32 0 L16 -8&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line">    svg.selectAll( <span class="string">&quot;path&quot;</span> ).data(data).enter().append( <span class="string">&quot;path&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;d&quot;</span>, arrow )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>,  <span class="comment">// 一開始都是畫在左上角的原點，所以需要將他移到適當的位置</span></span><br><span class="line">               <span class="function"><span class="params">d</span>=&gt;</span><span class="string">&quot;translate(&quot;</span> + d[<span class="string">&quot;x&quot;</span>] + <span class="string">&quot;,&quot;</span> + d[<span class="string">&quot;y&quot;</span>] + <span class="string">&quot;)&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          makeDemo05_2()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;320&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">lightgrey</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_2;</span><br></pre></td></tr></table></figure>
<h1 id="使用-defs-和-use-方式引入符號"><a href="#使用-defs-和-use-方式引入符號" class="headerlink" title="使用 defs 和 use 方式引入符號"></a>使用 defs 和 use 方式引入符號</h1><img src="/2022/01/30/frontend-d3-005-draw-shape/03.png" class="" title="03.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = [ [<span class="number">180</span>, <span class="number">1</span>], [<span class="number">260</span>, <span class="number">3</span>], [<span class="number">340</span>, <span class="number">2</span>], [<span class="number">420</span>, <span class="number">4</span>] ]; <span class="comment">// [x, scale]</span></span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> )</span><br><span class="line">        .selectAll( <span class="string">&quot;use&quot;</span> ).data( data ).enter().append( <span class="string">&quot;use&quot;</span> )  <span class="comment">// 建立可以引用 defs 的元素</span></span><br><span class="line">        .attr( <span class="string">&quot;href&quot;</span>, <span class="string">&quot;#crosshair&quot;</span> )                             <span class="comment">// 使用 ID 選取器設定引用哪個 defs</span></span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>,                                       <span class="comment">// 移動位置與縮放比例</span></span><br><span class="line">               <span class="function"><span class="params">d</span>=&gt;</span><span class="string">&quot;translate(&quot;</span>+d[<span class="number">0</span>]+<span class="string">&quot;,50) scale(&quot;</span>+<span class="number">2</span>*d[<span class="number">1</span>]+<span class="string">&quot;)&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;black&quot;</span> )                                <span class="comment">// 設定框線</span></span><br><span class="line">        .attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span><span class="number">0.5</span>/<span class="built_in">Math</span>.sqrt(d[<span class="number">1</span>]) );          <span class="comment">// 設定框線寬度</span></span><br><span class="line">    </span><br><span class="line">    d3.select(<span class="string">&quot;svg&quot;</span>).append( <span class="string">&quot;use&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;href&quot;</span>, <span class="string">&quot;#my_symbol&quot;</span>)</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>,</span><br><span class="line">            <span class="function"><span class="params">d</span>=&gt;</span><span class="string">&quot;translate(50, 50) scale(2)&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;blue&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="string">&quot;12&quot;</span> );   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> d = d3.select( <span class="string">&quot;svg&quot;</span> ).append(<span class="string">&quot;defs&quot;</span>).append(<span class="string">&quot;g&quot;</span>).attr(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;my_symbol&quot;</span>)</span><br><span class="line">        d.append(<span class="string">&quot;line&quot;</span>).attr(<span class="string">&quot;x1&quot;</span>, -<span class="number">1</span>).attr(<span class="string">&quot;y1&quot;</span>, <span class="number">1</span>).attr(<span class="string">&quot;x2&quot;</span>, <span class="number">1</span>).attr(<span class="string">&quot;y2&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">        d.append(<span class="string">&quot;line&quot;</span>).attr(<span class="string">&quot;x1&quot;</span>, -<span class="number">1</span>).attr(<span class="string">&quot;y1&quot;</span>, -<span class="number">1</span>).attr(<span class="string">&quot;x2&quot;</span>, <span class="number">1</span>).attr(<span class="string">&quot;y2&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        makeDemo05_3()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">lightgrey</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">defs</span>&gt;</span>  &#123;/* 定義一個元件 */&#125;                                 </span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">g</span> <span class="attr">id</span>=<span class="string">&quot;crosshair&quot;</span>&gt;</span>  &#123;/* 建立容器元素來容納所需元素 */&#125;                              </span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;0&quot;</span> <span class="attr">r</span>=<span class="string">&quot;2&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span>/&gt;</span> &#123;/* 因為最後在使用時會縮放大小，所以尺寸大小在這裡並不重要 */&#125; </span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;-3&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;0&quot;</span> /&gt;</span>                    </span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;1&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;3&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;-3&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;1&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">g</span>&gt;</span>                                                        </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_3;</span><br></pre></td></tr></table></figure>

<h1 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h1><ul>
<li>scale() 不只幫物件尺寸放大，也會將其座標一併放大<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.select(<span class="string">&quot;svg&quot;</span>).append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, <span class="number">0</span> )</span><br><span class="line">        .attr( <span class="string">&quot;y&quot;</span>, <span class="number">0</span> )</span><br><span class="line">        .attr( <span class="string">&quot;width&quot;</span>, <span class="number">20</span> )</span><br><span class="line">        .attr( <span class="string">&quot;height&quot;</span>, <span class="number">50</span> )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;blue&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">1</span>).attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;scale(2)&quot;</span>);</span><br><span class="line">    d3.select(<span class="string">&quot;svg&quot;</span>).append(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;x1&quot;</span>, <span class="number">100</span>)</span><br><span class="line">        .attr(<span class="string">&quot;y1&quot;</span>, <span class="number">20</span>)</span><br><span class="line">        .attr(<span class="string">&quot;x2&quot;</span>, <span class="number">100</span>)</span><br><span class="line">        .attr(<span class="string">&quot;y2&quot;</span>, <span class="number">40</span>)</span><br><span class="line">        .attr(<span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span>)</span><br><span class="line">        .attr(<span class="string">&quot;stroke-width&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    d3.select(<span class="string">&quot;svg&quot;</span>).append(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, <span class="number">100</span> )</span><br><span class="line">        .attr( <span class="string">&quot;y&quot;</span>, <span class="number">20</span> )</span><br><span class="line">        .attr( <span class="string">&quot;width&quot;</span>, <span class="number">20</span> )</span><br><span class="line">        .attr( <span class="string">&quot;height&quot;</span>, <span class="number">50</span> )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;green&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">1</span>).attr(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;scale(2)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo05_4()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;600&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">white</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_4;</span><br></pre></td></tr></table></figure>
<img src="/2022/01/30/frontend-d3-005-draw-shape/04.png" class="" title="04.png">
紅線部份是原始綠框的座標位置，但是隨著 scale() 的作用，也把座標位置放大了<br>所以一般來說建立圖形的流程都是 :</li>
</ul>
<ol>
<li>先只在原點上建立物件</li>
<li>套用縮放、旋轉 …</li>
<li>移動到想要放置的位置</li>
</ol>
<ul>
<li>transform 的函數組合是由右邊開始套用<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;rect transform=<span class="string">&quot;translate(10, 20) scale(2) rotate(30)&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
其作用順序會是將矩形旋轉 30 度，接著放大 2 倍，最後才是移動到座標點 (10, 20)</li>
</ul>
<h1 id="線條"><a href="#線條" class="headerlink" title="線條"></a>線條</h1><ul>
<li>d3.line() : 傳回一個線條產生器 (mkr)</li>
<li>mkr( data ) : 添加資料集，並傳回一個可被添加到 &lt;path&gt; 屬性 d 的字串</li>
<li>mkr.x( function(d, i, ds) {…} ) : 設定 x 座標</li>
<li>mkr.y( function(d, i, ds) {…} ) : 設定 y 座標</li>
<li>mkr.defined( function(d, i, ds) {…} ) : 用來標記哪點座標點是 undefined 的</li>
<li>mkr.curve( curve ) : 使用曲線方式繪製，預設是直線段<img src="/2022/01/30/frontend-d3-005-draw-shape/05.png" class="" title="05.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_5</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ds = [ [<span class="number">6</span>, <span class="number">2</span>], [<span class="number">7</span>, <span class="number">3</span>], [<span class="number">8</span>, <span class="number">1</span>], [<span class="number">9</span>, <span class="number">2</span>],[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">2</span>] ];</span><br><span class="line">    ds = ds.sort( <span class="function">(<span class="params">a, b</span>) =&gt;</span> a[<span class="number">0</span>] - b[<span class="number">0</span>] )  <span class="comment">// 因為線條產生器會依據資料順序繪製，如果我們有讓它由 x 座標小的畫至大的就要先排序過</span></span><br><span class="line">    <span class="keyword">var</span> xSc = d3.scaleLinear().domain([<span class="number">1</span>,<span class="number">9</span>]).range([<span class="number">50</span>,<span class="number">250</span>]);  <span class="comment">// 先套用 scale 到資料集</span></span><br><span class="line">    <span class="keyword">var</span> ySc = d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">5</span>]).range([<span class="number">175</span>,<span class="number">25</span>]);  <span class="comment">// 讓後面的程式碼簡潔</span></span><br><span class="line">    ds = ds.map( <span class="function"><span class="params">d</span> =&gt;</span> [xSc(d[<span class="number">0</span>]), ySc(d[<span class="number">1</span>])] );  <span class="comment">// 封裝在一個物件中方便取用</span></span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> ).selectAll( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">        .data( ds ).enter().append( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;r&quot;</span>, <span class="number">3</span> )  <span class="comment">// 傳入已經 scale 過的資料集</span></span><br><span class="line">        .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>] ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>] );  <span class="comment">// 直接取用不需要 scale</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//var lnMkr = d3.line();  // 取得繪製線條產生器</span></span><br><span class="line">    <span class="keyword">var</span> lnMkr = d3.line()  <span class="comment">// 取得繪製線條產生器</span></span><br><span class="line">                    .x(<span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>])  <span class="comment">// 設定 x 座標取用的資料</span></span><br><span class="line">                    .y(<span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>])  <span class="comment">// 設定 y 座標取用的資料</span></span><br><span class="line">                    .defined(<span class="function">(<span class="params">d, i</span>) =&gt;</span> i==<span class="number">3</span> ? <span class="literal">false</span> : <span class="literal">true</span>);  <span class="comment">// 定義哪些點是不連的，</span></span><br><span class="line">                    <span class="comment">// 此例是第 4 個座標點是不可連線的，即第 3/5 點是沒有線段連向第 4 點</span></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> ).append( <span class="string">&quot;path&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;d&quot;</span>, lnMkr(ds) )  <span class="comment">// 將資料集傳給線條產生器</span></span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_5</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo05_5()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_5;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="曲線"><a href="#曲線" class="headerlink" title="曲線"></a>曲線</h1><img src="/2022/01/30/frontend-d3-005-draw-shape/06.png" class="" title="06.png">
<p>代碼出處 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/shapes.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/shapes.js</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_6</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ds0 = [[<span class="number">1</span>,<span class="number">1</span>], [<span class="number">2</span>,<span class="number">2</span>], [<span class="number">2.5</span>,<span class="number">4</span>], [<span class="number">3</span>,<span class="number">4</span>], [<span class="number">4</span>,<span class="number">2</span>], [<span class="number">4.5</span>,<span class="number">2.5</span>], [<span class="number">5</span>,<span class="number">1.5</span>]];</span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear().domain([<span class="number">1</span>,<span class="number">5</span>]).range([<span class="number">0</span>,<span class="number">180</span>]);</span><br><span class="line">    <span class="keyword">var</span> scY = d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">4.5</span>]).range([<span class="number">160</span>,<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">var</span> ds = ds0.map( <span class="function"><span class="params">d</span> =&gt;</span> [scX(d[<span class="number">0</span>]), scY(d[<span class="number">1</span>])] );</span><br><span class="line">    <span class="keyword">var</span> txtpos = [ scX(<span class="number">3</span>), scY(<span class="number">0</span>) ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line">    </span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 40, 40 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, d3.curveLinear, <span class="string">&quot;d3.curveLinear&quot;</span>, txtpos );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 260, 40 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, d3.curveNatural, <span class="string">&quot;d3.curveNatural&quot;</span>, txtpos );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 480, 40 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, d3.curveMonotoneX, <span class="string">&quot;d3.curveMonotoneX&quot;</span>, txtpos );</span><br><span class="line"></span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 40, 250 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, d3.curveStep, <span class="string">&quot;d3.curveStep&quot;</span>, txtpos );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 260, 250 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, d3.curveStepAfter, <span class="string">&quot;d3.curveStepAfter&quot;</span>, txtpos );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 480, 250 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, d3.curveStepBefore, <span class="string">&quot;d3.curveStepBefore&quot;</span>, txtpos );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// blue: val=0, ... red: val=1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> vs = [ <span class="number">1</span>, <span class="number">0.75</span>, <span class="number">0.5</span>, <span class="number">0.25</span>, <span class="number">0</span> ];</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 40, 460 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, vs.map( <span class="function"><span class="params">v</span>=&gt;</span>d3.curveCardinal.tension(v) ),</span><br><span class="line">	       <span class="string">&quot;d3.curveCardinal&quot;</span>, txtpos );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 260, 460 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, vs.map( <span class="function"><span class="params">v</span>=&gt;</span>d3.curveCatmullRom.alpha(v) ),</span><br><span class="line">	       <span class="string">&quot;d3.curveCatmullRom&quot;</span>, txtpos );</span><br><span class="line">    svg.append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate( 480, 460 )&quot;</span> )</span><br><span class="line">	.call( liner, ds, vs.map( <span class="function"><span class="params">v</span>=&gt;</span>d3.curveBundle.beta(v) ),</span><br><span class="line">	       <span class="string">&quot;d3.curveBundle&quot;</span>, txtpos )</span><br><span class="line"><span class="comment">//   	.call( liner, ds, d3.curveBasisClosed, &quot;&quot;, txtpos )</span></span><br><span class="line">	.append( <span class="string">&quot;text&quot;</span> )</span><br><span class="line">	.attr( <span class="string">&quot;x&quot;</span>, txtpos[<span class="number">0</span>] ).attr( <span class="string">&quot;y&quot;</span>, scY(-<span class="number">0.5</span>) )</span><br><span class="line">	.attr( <span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;font-family&quot;</span>, <span class="string">&quot;sans-serif&quot;</span>).attr( <span class="string">&quot;font-size&quot;</span>, <span class="string">&quot;10.5pt&quot;</span> )</span><br><span class="line">	.text( <span class="string">&quot;d3.curveBasis&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">liner</span>(<span class="params"> g, ds, curve, txt, pos </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( !(curve <span class="keyword">instanceof</span> <span class="built_in">Array</span>) ) &#123;</span><br><span class="line">	curve = [ curve ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sc = d3.scaleLinear()</span><br><span class="line">	.domain( [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>] ).range( [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;magenta&quot;</span>, <span class="string">&quot;blue&quot;</span>] );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> lnMkr = d3.line();</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>; i&lt;curve.length; i++ ) &#123;</span><br><span class="line">	g.append( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;d&quot;</span>, lnMkr.curve(curve[i])(ds) )</span><br><span class="line">   	    .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, sc(i) );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g.selectAll( <span class="string">&quot;circle&quot;</span> ).data( ds ).enter().append( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">	.attr( <span class="string">&quot;r&quot;</span>, <span class="number">3</span> )</span><br><span class="line">	.attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>] ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>] )</span><br><span class="line">	.attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;black&quot;</span> );</span><br><span class="line">    </span><br><span class="line">    g.append( <span class="string">&quot;text&quot;</span> )</span><br><span class="line">	.attr( <span class="string">&quot;x&quot;</span>, pos[<span class="number">0</span>] ).attr( <span class="string">&quot;y&quot;</span>, pos[<span class="number">1</span>] )</span><br><span class="line">	.attr( <span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;font-family&quot;</span>, <span class="string">&quot;sans-serif&quot;</span>).attr( <span class="string">&quot;font-size&quot;</span>, <span class="string">&quot;10.5pt&quot;</span> )</span><br><span class="line">	.text( txt );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_6</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo05_6()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;695&quot;</span> <span class="attr">width</span>=<span class="string">&quot;700&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_6;</span><br></pre></td></tr></table></figure>

<h1 id="自訂曲線"><a href="#自訂曲線" class="headerlink" title="自訂曲線"></a>自訂曲線</h1><p>自定義一個具有參數 d3.path 物件的 function，並且傳回一個物件具有 lineStart、point 及 lineEnd</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ds = [ [<span class="number">6</span>, <span class="number">2</span>], [<span class="number">7</span>, <span class="number">3</span>], [<span class="number">8</span>, <span class="number">1</span>], [<span class="number">9</span>, <span class="number">2</span>],[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">2</span>] ];</span><br><span class="line">    ds = ds.sort( <span class="function">(<span class="params">a, b</span>) =&gt;</span> a[<span class="number">0</span>] - b[<span class="number">0</span>] )  <span class="comment">// 因為線條產生器會依據資料順序繪製，如果我們有讓它由 x 座標小的畫至大的就要先排序過</span></span><br><span class="line">    <span class="keyword">var</span> xSc = d3.scaleLinear().domain([<span class="number">1</span>,<span class="number">9</span>]).range([<span class="number">50</span>,<span class="number">250</span>]);  <span class="comment">// 先套用 scale 到資料集</span></span><br><span class="line">    <span class="keyword">var</span> ySc = d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">5</span>]).range([<span class="number">175</span>,<span class="number">25</span>]);  <span class="comment">// 讓後面的程式碼簡潔</span></span><br><span class="line">    ds = ds.map( <span class="function"><span class="params">d</span> =&gt;</span> [xSc(d[<span class="number">0</span>]), ySc(d[<span class="number">1</span>])] );  <span class="comment">// 封裝在一個物件中方便取用</span></span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> ).selectAll( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">        .data( ds ).enter().append( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;r&quot;</span>, <span class="number">3</span> )  <span class="comment">// 傳入已經 scale 過的資料集</span></span><br><span class="line">        .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>] ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>] );  <span class="comment">// 直接取用不需要 scale</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> lnMkr = d3.line();  <span class="comment">// 取得繪製線條產生器</span></span><br><span class="line">    lnMkr.curve( myCurve )</span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> ).append( <span class="string">&quot;path&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;d&quot;</span>, lnMkr(ds) )  <span class="comment">// 將資料集傳給線條產生器</span></span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCurve</span>(<span class="params"> context </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">lineStart</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.data = []</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">point</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> x, y </span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.data.push( [x, y] )</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">lineEnd</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> xrange = d3.extent( <span class="built_in">this</span>.data, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>] )</span><br><span class="line">            <span class="keyword">var</span> median = d3.median( <span class="built_in">this</span>.data, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>] )</span><br><span class="line"></span><br><span class="line">            context.moveTo( xrange[<span class="number">0</span>], median )</span><br><span class="line">            context.lineTo( xrange[<span class="number">1</span>], median )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo05_7()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_7;</span><br></pre></td></tr></table></figure>

<h1 id="Pie-amp-Arc"><a href="#Pie-amp-Arc" class="headerlink" title="Pie &amp; Arc"></a>Pie &amp; Arc</h1><ul>
<li>d3.pie : 傳回 pie layout</li>
<li>mkr( data ) : 傳入一個資料陣列，則會返回一個物件陣列，物件成員有<br>data : 切片資料<br>value : 切片數值<br>index : 切片順序<br>startAngle : 切片開始角度，以弧度為單位<br>endAngle : 切片結束角度，以弧度為單位<br>padAngle : 切片間填充角度，以弧度為單位</li>
<li>mkr.value( arg ) : 切片數值設值/取值</li>
<li>mkr.sort( comparator ) : 切片數值排序方式</li>
<li>mkr.startAngle( arg ) : 切片開始角度設值/取值</li>
<li>mkr.endAngle( arg ) : 切片結束角度設值/取值</li>
<li>mkr.padAngle( arg ) : 切片間填充角度設值/取值</li>
</ul>
<p>arc generator</p>
<ul>
<li>d3.arc() : 傳回一個 arc generator</li>
<li>mkr( args ) : </li>
<li>mkr.innerRadius( arg ) : 設定內徑</li>
<li>mkr.outerRadius( arg ) : 設定外徑</li>
<li>mkr.startAngle( arg ) : 設定開始角度，順時針且不可為負</li>
<li>mkr.endAngle( arg ) : 設定結束角度，順時針且不可為負</li>
<li>mkr.centroid() : 切片的中間位置座標</li>
<li>mkr.cornerRadius( arg ) : 圓角的邊角半徑<br>圓餅圖範例<img src="/2022/01/30/frontend-d3-005-draw-shape/07.png" class="" title="07.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = [ &#123; <span class="attr">name</span>: <span class="string">&quot;Jim&quot;</span>, <span class="attr">votes</span>: <span class="number">12</span> &#125;,</span><br><span class="line">                 &#123; <span class="attr">name</span>: <span class="string">&quot;Sue&quot;</span>, <span class="attr">votes</span>:  <span class="number">5</span> &#125;,</span><br><span class="line">                 &#123; <span class="attr">name</span>: <span class="string">&quot;Bob&quot;</span>, <span class="attr">votes</span>: <span class="number">21</span> &#125;,</span><br><span class="line">                 &#123; <span class="attr">name</span>: <span class="string">&quot;Ann&quot;</span>, <span class="attr">votes</span>: <span class="number">17</span> &#125;,</span><br><span class="line">                 &#123; <span class="attr">name</span>: <span class="string">&quot;Dan&quot;</span>, <span class="attr">votes</span>:  <span class="number">3</span> &#125; ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pie = d3.pie()  <span class="comment">// 傳回一個 pie layout</span></span><br><span class="line">                .value(<span class="function"><span class="params">d</span>=&gt;</span>d.votes)  <span class="comment">// 設定 pie 的數值</span></span><br><span class="line">                <span class="comment">//.sort( null )  // 預設為正向排序 (多到少)，依據資料集順序</span></span><br><span class="line">                <span class="comment">//.sort( (a, b) =&gt; a.votes - b.votes)  // 反序 (少到多)</span></span><br><span class="line">                .padAngle(<span class="number">0.025</span>)  <span class="comment">// 設定兩個餅之間的距離</span></span><br><span class="line">                ( data );  <span class="comment">// 傳入資料集</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> arcMkr = d3.arc()  <span class="comment">// 傳回一個 arc 產生器</span></span><br><span class="line">                    .innerRadius( <span class="number">50</span> )  <span class="comment">// 設定內徑</span></span><br><span class="line">                    .outerRadius( <span class="number">150</span> )  <span class="comment">// 設定外徑</span></span><br><span class="line">                    .cornerRadius( <span class="number">10</span> );  <span class="comment">// 設定邊角的圓角半徑 </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> scC = d3.scaleOrdinal( d3.schemePastel2 ) <span class="comment">// 建立每個 pie 對應的顏色盤</span></span><br><span class="line">        .domain( pie.map(<span class="function"><span class="params">d</span>=&gt;</span>d.index) )  <span class="comment">// 使用 index 做區別</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> g = d3.select( <span class="string">&quot;svg&quot;</span> )  <span class="comment">// 建立一個容器元素用以裝 path</span></span><br><span class="line">        .append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(300, 175)&quot;</span> )</span><br><span class="line"></span><br><span class="line">    g.selectAll( <span class="string">&quot;path&quot;</span> ).data( pie ).enter().append( <span class="string">&quot;path&quot;</span> )  <span class="comment">// 傳入 pie 結構的資料集</span></span><br><span class="line">        .attr( <span class="string">&quot;d&quot;</span>, arcMkr )  <span class="comment">// 根據 pie 結構繪製弧形</span></span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scC(d.index) ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;grey&quot;</span> );</span><br><span class="line"></span><br><span class="line">    g.selectAll( <span class="string">&quot;text&quot;</span> ).data( pie ).enter().append( <span class="string">&quot;text&quot;</span> )  <span class="comment">// 繪製文字標籤</span></span><br><span class="line">        .text( <span class="function"><span class="params">d</span> =&gt;</span> d.data.name )</span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>arcMkr.innerRadius(<span class="number">85</span>).centroid(d)[<span class="number">0</span>] )  <span class="comment">// 取內徑到外徑的中點當位置</span></span><br><span class="line">        .attr( <span class="string">&quot;y&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>arcMkr.innerRadius(<span class="number">85</span>).centroid(d)[<span class="number">1</span>] )</span><br><span class="line">        .attr( <span class="string">&quot;font-family&quot;</span>, <span class="string">&quot;sans-serif&quot;</span> ).attr( <span class="string">&quot;font-size&quot;</span>, <span class="number">14</span> )</span><br><span class="line">        .attr( <span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo05_8()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;350&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_8;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="自訂組件"><a href="#自訂組件" class="headerlink" title="自訂組件"></a>自訂組件</h1><img src="/2022/01/30/frontend-d3-005-draw-shape/08.png" class="" title="08.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sticker</span>(<span class="params"> sel, label </span>) </span>&#123;</span><br><span class="line">    sel.append( <span class="string">&quot;rect&quot;</span> ).attr( <span class="string">&quot;rx&quot;</span>, <span class="number">5</span> ).attr( <span class="string">&quot;ry&quot;</span>, <span class="number">5</span> )</span><br><span class="line">        .attr( <span class="string">&quot;width&quot;</span>, <span class="number">70</span> ).attr( <span class="string">&quot;height&quot;</span>, <span class="number">30</span> )</span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, -<span class="number">35</span> ).attr( <span class="string">&quot;y&quot;</span>, -<span class="number">15</span> )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;blue&quot;</span> )</span><br><span class="line">        .classed( <span class="string">&quot;frame&quot;</span>, <span class="literal">true</span> );</span><br><span class="line">        </span><br><span class="line">    sel.append( <span class="string">&quot;text&quot;</span> ).attr( <span class="string">&quot;x&quot;</span>, <span class="number">0</span> ).attr( <span class="string">&quot;y&quot;</span>, <span class="number">5</span> )</span><br><span class="line">        .attr( <span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;font-family&quot;</span>, <span class="string">&quot;sans-serif&quot;</span> ).attr( <span class="string">&quot;font-size&quot;</span>, <span class="number">14</span> )</span><br><span class="line">        .classed( <span class="string">&quot;label&quot;</span>, <span class="literal">true</span> )</span><br><span class="line">        .text( label ? label : <span class="function"><span class="params">d</span> =&gt;</span> d );  <span class="comment">// 可以透過參數會是繫結 data() 的方式</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo05_9</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> labels = [ <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>, <span class="string">&quot;How&quot;</span>, <span class="string">&quot;Are&quot;</span>, <span class="string">&quot;You?&quot;</span> ];</span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear()</span><br><span class="line">        .domain( [<span class="number">0</span>, labels.length-<span class="number">1</span>] ).range( [<span class="number">100</span>, <span class="number">500</span>] );</span><br><span class="line">    <span class="keyword">var</span> scY = d3.scaleLinear()</span><br><span class="line">        .domain( [<span class="number">0</span>, labels.length-<span class="number">1</span>] ).range( [<span class="number">50</span>, <span class="number">150</span>] );</span><br><span class="line">    </span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> )</span><br><span class="line">        .selectAll( <span class="string">&quot;g&quot;</span> ).data( labels ).enter().append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>,</span><br><span class="line">               <span class="function">(<span class="params">d,i</span>) =&gt;</span> <span class="string">&quot;translate(&quot;</span> + scX(i) + <span class="string">&quot;,&quot;</span> + scY(i) + <span class="string">&quot;)&quot;</span> )</span><br><span class="line">        .call( sticker );</span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(75,150)&quot;</span> )</span><br><span class="line">        .call( sticker, <span class="string">&quot;I&#x27;m fine!&quot;</span> )</span><br><span class="line">        .selectAll( <span class="string">&quot;.label&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo05_9</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        makeDemo05_9()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">rgb</span>(<span class="attr">230</span>, <span class="attr">230</span>, <span class="attr">230</span>)&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo05_9;</span><br></pre></td></tr></table></figure>
<ol>
<li>在 &lt;g&gt; 元素裡面建立組件</li>
<li>以 call() 方式呼叫組件的建立，而 call() 會自動地注入 selection 為第一個參數</li>
<li>外觀的設定，通常是在建立好組件之後才呼叫<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> ).attr( <span class="string">&quot;transform&quot;</span>, ...)</span><br><span class="line">    .call( myComponent )</span><br><span class="line">    .selectAll( <span class="string">&quot;rect&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, ... )...</span><br></pre></td></tr></table></figure>
封裝一些重複的代碼，將一些設定值提取變成函數的參數<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">texter</span>(<span class="params"> sel, ... </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sel.attr( ... );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">d3.select( ... ).append( <span class="string">&quot;text&quot;</span> ).call( texter , ... ).text( ... );</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="自訂組件的-transform"><a href="#自訂組件的-transform" class="headerlink" title="自訂組件的 transform"></a>自訂組件的 transform</h1><p>如果是透過 data() 繫結資料後建立的組件，就必須用以下方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trans</span>(<span class="params"> sel, dx, dy</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dxs = d3.local(), dys = d3.local();</span><br><span class="line">    sel.each( <span class="function"><span class="keyword">function</span>(<span class="params"> d, i </span>) </span>&#123;</span><br><span class="line">        dxs.set( <span class="built_in">this</span>, <span class="keyword">typeof</span> dx === <span class="string">&quot;function&quot;</span> ? dx( d, i ) : dx||<span class="number">0</span> )</span><br><span class="line">    &#125;);</span><br><span class="line">    sel.each( <span class="function"><span class="keyword">function</span>(<span class="params"> d, i </span>) </span>&#123;</span><br><span class="line">        dys.set( <span class="built_in">this</span>, <span class="keyword">typeof</span> dy === <span class="string">&quot;function&quot;</span> ? dy( d, i ) : dy||<span class="number">0</span> )</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> sel.attr( <span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + dxs.get(<span class="built_in">this</span>) + <span class="string">&quot;,&quot;</span> + dys.get(<span class="built_in">this</span>) + <span class="string">&quot;)&quot;</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trans</span>(<span class="params"> sel, dx, dy</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dxs = d3.local(), dys = d3.local();</span><br><span class="line">    sel.each( <span class="function"><span class="keyword">function</span>(<span class="params"> d, i </span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.local_dx = <span class="keyword">typeof</span> dx === <span class="string">&quot;function&quot;</span> ? dx( d, i ) : dx||<span class="number">0</span> )</span><br><span class="line">    &#125;);</span><br><span class="line">    sel.each( <span class="function"><span class="keyword">function</span>(<span class="params"> d, i </span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.local_dy = <span class="keyword">typeof</span> dy === <span class="string">&quot;function&quot;</span> ? dx( d, i ) : dy||<span class="number">0</span> )</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> sel.attr( <span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + <span class="built_in">this</span>.local_dx + <span class="string">&quot;,&quot;</span> + <span class="built_in">this</span>.local_dy + <span class="string">&quot;)&quot;</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">    .selectAll( <span class="string">&quot;g&quot;</span> ).data( vs ).enter().append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">    .call( trans, <span class="function">(<span class="params">d,i</span>)=&gt;</span> scx(d[<span class="number">0</span>]), <span class="function">(<span class="params">d,i</span>)=&gt;</span>scY(i))</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/29/frontend-d3-004-event/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/29/frontend-d3-004-event/" class="post-title-link" itemprop="url">D3 - 004 事件與動畫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-29 19:51:43" itemprop="dateCreated datePublished" datetime="2022-01-29T19:51:43+08:00">2022-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:14" itemprop="dateModified" datetime="2022-02-08T16:17:14+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>17 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="設定事件回調函數並取得事件相關資訊"><a href="#設定事件回調函數並取得事件相關資訊" class="headerlink" title="設定事件回調函數並取得事件相關資訊"></a>設定事件回調函數並取得事件相關資訊</h1><p>D3 中一些重要的事件</p>
<ul>
<li>click : 點擊滑鼠</li>
<li>mousemove : 滑鼠滑過元素</li>
<li>mousedown、mouseup : 按下/釋放滑鼠鍵</li>
<li>mouseenter、mouseleave : 滑鼠移進/移出</li>
<li>mouseover、mouseout : 滑鼠移進/移出</li>
<li>keydown、keyup : 按鍵按下/釋放</li>
</ul>
<p>設定某事件處理的回調函數</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sel.on( type, callback )</span><br></pre></td></tr></table></figure>
<p>若要移除回調函數，則使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sel.on( type, <span class="literal">null</span> )</span><br></pre></td></tr></table></figure>
<p>如果對同一個事件註冊兩次回調函數，則後者會把前者給覆蓋掉，若要對相同事件註冊多個回調函數，則必須在該事件名稱之後加上逗點 (.) 並取一個任意字串，如 ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sel.on( <span class="string">&quot;click.event1&quot;</span>, callback1)</span><br><span class="line">...</span><br><span class="line">sel.on( <span class="string">&quot;click_event2&quot;</span>, callback2)</span><br></pre></td></tr></table></figure>
<p>取得滑鼠座標並顯示，注意 D3 v6 以上的版本取得事件相關資訊方式有變，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> txt = d3.select( <span class="string">&quot;svg&quot;</span> ).append( <span class="string">&quot;text&quot;</span> );</span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> ).attr( <span class="string">&quot;cursor&quot;</span>, <span class="string">&quot;crosshair&quot;</span> )  <span class="comment">// 把鼠標設為十字</span></span><br><span class="line">        .on( <span class="string">&quot;mousemove&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pt = d3.pointer( event, svg.node() );  <span class="comment">// D3 v6 以上的版本是使用 pointer() 取得事件相關資訊</span></span><br><span class="line">            txt.attr( <span class="string">&quot;x&quot;</span>, <span class="number">18</span>+pt[<span class="number">0</span>] ).attr( <span class="string">&quot;y&quot;</span>, <span class="number">6</span>+pt[<span class="number">1</span>] )</span><br><span class="line">                .text( <span class="string">&quot;&quot;</span> + pt[<span class="number">0</span>] + <span class="string">&quot;,&quot;</span> + pt[<span class="number">1</span>] );</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo04_1&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">          makeDemo04_1()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo04_1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_1;</span><br></pre></td></tr></table></figure>
<img src="/2022/01/29/frontend-d3-004-event/01.png" class="" title="01.png">

<h1 id="案例-同步標記"><a href="#案例-同步標記" class="headerlink" title="案例 - 同步標記"></a>案例 - 同步標記</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.csv( <span class="string">&quot;data/dense.csv&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params"> data </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> svg1 = d3.select( <span class="string">&quot;#svg1&quot;</span> );</span><br><span class="line">        <span class="keyword">var</span> svg2 = d3.select( <span class="string">&quot;#svg2&quot;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sc1=d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">10</span>,<span class="number">50</span>])  <span class="comment">// 在顏色之間填入差值，產生一個顏色梯度</span></span><br><span class="line">            .range([<span class="string">&quot;lime&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="string">&quot;red&quot;</span>]);</span><br><span class="line">        <span class="keyword">var</span> sc2=d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">10</span>,<span class="number">50</span>])</span><br><span class="line">            .range([<span class="string">&quot;lime&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="string">&quot;blue&quot;</span>]);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> cs1 = drawCircles(svg1,data,<span class="function"><span class="params">d</span>=&gt;</span>d[<span class="string">&quot;A&quot;</span>],<span class="function"><span class="params">d</span>=&gt;</span>d[<span class="string">&quot;B&quot;</span>],sc1);  <span class="comment">// 建立左側 svg 的圓點</span></span><br><span class="line">        <span class="keyword">var</span> cs2 = drawCircles(svg2,data,<span class="function"><span class="params">d</span>=&gt;</span>d[<span class="string">&quot;A&quot;</span>],<span class="function"><span class="params">d</span>=&gt;</span>d[<span class="string">&quot;C&quot;</span>],sc2);  <span class="comment">// 建立右側 svg 的圓點</span></span><br><span class="line">    </span><br><span class="line">        svg1.call( installHandlers, data, cs1, cs2, sc1, sc2 );  <span class="comment">// 使用 call() 呼叫 installHanders(data, cs1, cs2, sc1, sc2)</span></span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawCircles</span>(<span class="params"> svg, data, accX, accY, sc </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> color = sc(<span class="literal">Infinity</span>);  <span class="comment">// 設定初始的顏色值，皆採用顏色梯度做大值 (red / blue)</span></span><br><span class="line">    <span class="keyword">return</span> svg.selectAll( <span class="string">&quot;circle&quot;</span> ).data( data ).enter()</span><br><span class="line">        .append( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> ).attr( <span class="string">&quot;cx&quot;</span>, accX ).attr( <span class="string">&quot;cy&quot;</span>, accY )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, color ).attr( <span class="string">&quot;fill-opacity&quot;</span>, <span class="number">0.4</span> );  <span class="comment">// 設定透明度</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">installHandlers</span>(<span class="params"> svg, data, cs1, cs2, sc1, sc2 </span>) </span>&#123;</span><br><span class="line">    svg.attr( <span class="string">&quot;cursor&quot;</span>, <span class="string">&quot;crosshair&quot;</span> )</span><br><span class="line">        .on( <span class="string">&quot;mousemove&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;  <span class="comment">// 當滑鼠移入左側 (sgv1) 時</span></span><br><span class="line">            <span class="keyword">var</span> pt = d3.pointer( event, svg.node() );</span><br><span class="line">            </span><br><span class="line">            cs1.attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> d, i </span>) </span>&#123;  <span class="comment">// 傳入 csv 內的 data</span></span><br><span class="line">                <span class="keyword">var</span> dx = pt[<span class="number">0</span>] - d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;cx&quot;</span> );  <span class="comment">// 算出 data 的所有資料與滑鼠座標間的距離</span></span><br><span class="line">                <span class="keyword">var</span> dy = pt[<span class="number">1</span>] - d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;cy&quot;</span> );</span><br><span class="line">                <span class="keyword">var</span> r = <span class="built_in">Math</span>.hypot( dx, dy );  <span class="comment">// hypot 為算出  ((dx * dx) + (dy * dy)) 開根號</span></span><br><span class="line">                </span><br><span class="line">                data[i][<span class="string">&quot;r&quot;</span>] = r;  <span class="comment">// 把 r 值在 data 中另開一個欄位 r 儲存</span></span><br><span class="line">                <span class="keyword">return</span> sc1(r); &#125; );  <span class="comment">// 根據 r 值取出對應顏色梯度的顏色值</span></span><br><span class="line">            </span><br><span class="line">            cs2.attr( <span class="string">&quot;fill&quot;</span>, <span class="function">(<span class="params">d,i</span>) =&gt;</span> sc2( data[i][<span class="string">&quot;r&quot;</span>] ) ); &#125; )  <span class="comment">// 右側圖片的所有 data 也根據剛剛算出的 r 取出對應的顏色梯度值</span></span><br><span class="line">    </span><br><span class="line">        .on( <span class="string">&quot;mouseleave&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            cs1.attr( <span class="string">&quot;fill&quot;</span>, sc1(<span class="literal">Infinity</span>) );  <span class="comment">// 滑鼠離開圖表時，恢復原本顏色</span></span><br><span class="line">            cs2.attr( <span class="string">&quot;fill&quot;</span>, sc2(<span class="literal">Infinity</span>) ); &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ds1 = [<span class="string">&quot;svg1&quot;</span>, <span class="string">&quot;svg2&quot;</span>];</span><br><span class="line"></span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo04_2&#x27;</span>)</span><br><span class="line">            .selectAll(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">            .data(ds1).enter()</span><br><span class="line">            .append(<span class="string">&#x27;svg&#x27;</span>).attr(<span class="string">&quot;id&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d)</span><br><span class="line">            .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">            .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>)</span><br><span class="line">            .style(<span class="string">&quot;margin&quot;</span>, <span class="number">20</span>);</span><br><span class="line">          makeDemo04_2()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo04_2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_2;</span><br></pre></td></tr></table></figure>
<p>進入前</p>
<img src="/2022/01/29/frontend-d3-004-event/02.png" class="" title="02.png">
<p>進入後</p>
<img src="/2022/01/29/frontend-d3-004-event/03.png" class="" title="03.png">

<h1 id="改良同步標記"><a href="#改良同步標記" class="headerlink" title="改良同步標記"></a>改良同步標記</h1><p>設定自製鼠標，設定熱區，當鼠標一進到該區中，則隱藏系統鼠標，顯示自製鼠標</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.csv( <span class="string">&quot;data/dense.csv&quot;</span> ).then( <span class="function"><span class="keyword">function</span>(<span class="params"> data </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> svg1 = d3.select( <span class="string">&quot;#svg1&quot;</span> );</span><br><span class="line">        <span class="keyword">var</span> svg2 = d3.select( <span class="string">&quot;#svg2&quot;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sc1=d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">10</span>,<span class="number">50</span>])  <span class="comment">// 在顏色之間填入差值，產生一個顏色梯度</span></span><br><span class="line">            .range([<span class="string">&quot;lime&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="string">&quot;red&quot;</span>]);</span><br><span class="line">        <span class="keyword">var</span> sc2=d3.scaleLinear().domain([<span class="number">0</span>,<span class="number">10</span>,<span class="number">50</span>])</span><br><span class="line">            .range([<span class="string">&quot;lime&quot;</span>,<span class="string">&quot;yellow&quot;</span>,<span class="string">&quot;blue&quot;</span>]);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> cs1 = drawCircles(svg1,data,<span class="function"><span class="params">d</span>=&gt;</span><span class="built_in">parseInt</span>(d[<span class="string">&quot;A&quot;</span>])+<span class="number">50</span>,<span class="function"><span class="params">d</span>=&gt;</span><span class="built_in">parseInt</span>(d[<span class="string">&quot;B&quot;</span>])+<span class="number">50</span>,sc1);  <span class="comment">// 建立左側 svg 的圓點</span></span><br><span class="line">        <span class="keyword">var</span> cs2 = drawCircles(svg2,data,<span class="function"><span class="params">d</span>=&gt;</span><span class="built_in">parseInt</span>(d[<span class="string">&quot;A&quot;</span>])+<span class="number">50</span>,<span class="function"><span class="params">d</span>=&gt;</span><span class="built_in">parseInt</span>(d[<span class="string">&quot;C&quot;</span>])+<span class="number">50</span>,sc2);  <span class="comment">// 建立右側 svg 的圓點</span></span><br><span class="line">    </span><br><span class="line">        svg1.call( installHandlers, data, cs1, cs2, sc1, sc2 );  <span class="comment">// 使用 call() 呼叫 installHanders(data, cs1, cs2, sc1, sc2)</span></span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawCircles</span>(<span class="params"> svg, data, accX, accY, sc </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> color = sc(<span class="literal">Infinity</span>);  <span class="comment">// 設定初始的顏色值，皆採用顏色梯度做大值 (red / blue)</span></span><br><span class="line">    <span class="keyword">return</span> svg.selectAll( <span class="string">&quot;circle&quot;</span> ).data( data ).enter()</span><br><span class="line">        .append( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> ).attr( <span class="string">&quot;cx&quot;</span>, accX ).attr( <span class="string">&quot;cy&quot;</span>, accY )</span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, color ).attr( <span class="string">&quot;fill-opacity&quot;</span>, <span class="number">0.4</span> );  <span class="comment">// 設定透明度</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">installHandlers</span>(<span class="params"> svg, data, cs1, cs2, sc1, sc2 </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cursor = svg.append( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;r&quot;</span>, <span class="number">50</span> )  <span class="comment">// 建立一個不透明的圓環</span></span><br><span class="line">        .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;black&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">10</span> ).attr( <span class="string">&quot;stroke-opacity&quot;</span>, <span class="number">0.1</span> )</span><br><span class="line">        .attr( <span class="string">&quot;visibility&quot;</span>, <span class="string">&quot;hidden&quot;</span> );  <span class="comment">// 一開始為隱藏的，等到鼠標進入到 hotzone 時才顯示，被當作鼠標功能使用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> hotzone = svg.append( <span class="string">&quot;rect&quot;</span> ).attr( <span class="string">&quot;cursor&quot;</span>, <span class="string">&quot;none&quot;</span> )  <span class="comment">// 設定進入此元素時，沒有鼠標顯示</span></span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, <span class="number">50</span> ).attr( <span class="string">&quot;y&quot;</span>, <span class="number">50</span> )</span><br><span class="line">        .attr( <span class="string">&quot;width&quot;</span>, <span class="number">300</span> ).attr( <span class="string">&quot;height&quot;</span>, <span class="number">300</span> )</span><br><span class="line">        .attr( <span class="string">&quot;visibility&quot;</span>, <span class="string">&quot;hidden&quot;</span> )  <span class="comment">// 設定為隱藏的</span></span><br><span class="line">        .attr( <span class="string">&quot;pointer-events&quot;</span>, <span class="string">&quot;all&quot;</span> )   <span class="comment">// 因為 visibility 設定為 hidden，所以預設是不接收事件的，所以需要靠此設定打開接收事件</span></span><br><span class="line">    </span><br><span class="line">        .on( <span class="string">&quot;mouseenter&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            cursor.attr( <span class="string">&quot;visibility&quot;</span>, <span class="string">&quot;visible&quot;</span> ); &#125; )  <span class="comment">// 當滑鼠進入時，將 curser 顯示，當作鼠標使用</span></span><br><span class="line">        </span><br><span class="line">        .on( <span class="string">&quot;mousemove&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pt = d3.pointer( event, svg.node() );</span><br><span class="line">            cursor.attr( <span class="string">&quot;cx&quot;</span>, pt[<span class="number">0</span>] ).attr( <span class="string">&quot;cy&quot;</span>, pt[<span class="number">1</span>] );  <span class="comment">// 當滑鼠移動時，自製鼠標也跟著移動</span></span><br><span class="line"></span><br><span class="line">            cs1.attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> d, i </span>) </span>&#123;  <span class="comment">// </span></span><br><span class="line">                <span class="keyword">var</span> dx = pt[<span class="number">0</span>] - d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;cx&quot;</span> );</span><br><span class="line">                <span class="keyword">var</span> dy = pt[<span class="number">1</span>] - d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;cy&quot;</span> );</span><br><span class="line">                <span class="keyword">var</span> r = <span class="built_in">Math</span>.hypot( dx, dy );</span><br><span class="line"></span><br><span class="line">                data[i][<span class="string">&quot;r&quot;</span>] = r;</span><br><span class="line">                <span class="keyword">return</span> sc1(r); &#125; );</span><br><span class="line">            </span><br><span class="line">            cs2.attr( <span class="string">&quot;fill&quot;</span>, <span class="function">(<span class="params">d,i</span>) =&gt;</span> sc2( data[i][<span class="string">&quot;r&quot;</span>] ) ); &#125; )</span><br><span class="line"></span><br><span class="line">        .on( <span class="string">&quot;mouseleave&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;                                 </span><br><span class="line">            cursor.attr( <span class="string">&quot;visibility&quot;</span>, <span class="string">&quot;hidden&quot;</span> );  <span class="comment">// 當滑鼠移出時也隱藏自製鼠標</span></span><br><span class="line">            cs1.attr( <span class="string">&quot;fill&quot;</span>, sc1(<span class="literal">Infinity</span>) );</span><br><span class="line">            cs2.attr( <span class="string">&quot;fill&quot;</span>, sc2(<span class="literal">Infinity</span>) ); &#125; )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ds1 = [<span class="string">&quot;svg1&quot;</span>, <span class="string">&quot;svg2&quot;</span>];</span><br><span class="line"></span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo04_3&#x27;</span>)</span><br><span class="line">            .selectAll(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">            .data(ds1).enter()</span><br><span class="line">            .append(<span class="string">&#x27;svg&#x27;</span>).attr(<span class="string">&quot;id&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d)</span><br><span class="line">            .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">            .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>)</span><br><span class="line">            .style(<span class="string">&quot;margin&quot;</span>, <span class="number">20</span>);</span><br><span class="line">          makeDemo04_3()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo04_3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_3;</span><br></pre></td></tr></table></figure>
<p>進入前</p>
<img src="/2022/01/29/frontend-d3-004-event/04.png" class="" title="04.png">
<p>進入後</p>
<img src="/2022/01/29/frontend-d3-004-event/05.png" class="" title="05.png">

<h1 id="拖曳"><a href="#拖曳" class="headerlink" title="拖曳"></a>拖曳</h1><p>要在 D3 使用滑鼠來改變 SVG 元件並不困難，而為了讓拖曳操作更容易，D3 提供了一個行為元件 (darg())</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> widget = <span class="literal">undefined</span>, color = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> drag = d3.drag()  <span class="comment">// 使用此工廠函數建立一個 drag 函數物件</span></span><br><span class="line">        .on( <span class="string">&quot;start&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// 模擬 mousedown 時的動作，取得元件</span></span><br><span class="line">            color = d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;fill&quot;</span> );  <span class="comment">// 儲存該元件的顏色，以便在 mouseup 時設回</span></span><br><span class="line">            widget = d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;lime&quot;</span> );  <span class="comment">// 改變該元件的顏色</span></span><br><span class="line">        &#125; )</span><br><span class="line">        .on( <span class="string">&quot;drag&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123; <span class="comment">// 模擬 mousemove</span></span><br><span class="line">            <span class="keyword">var</span> pt = d3.pointer( event, d3.select( <span class="built_in">this</span> ).node() );  <span class="comment">// 取得滑鼠座標</span></span><br><span class="line">            widget.attr( <span class="string">&quot;cx&quot;</span>, pt[<span class="number">0</span>] ).attr( <span class="string">&quot;cy&quot;</span>, pt[<span class="number">1</span>] );  <span class="comment">// 改變元件位置</span></span><br><span class="line">        &#125; )</span><br><span class="line">        .on( <span class="string">&quot;end&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// 模擬 mouseup</span></span><br><span class="line">            widget.attr( <span class="string">&quot;fill&quot;</span>, color );  <span class="comment">// 設回原來顏色</span></span><br><span class="line">            widget = <span class="literal">undefined</span>;</span><br><span class="line">        &#125; );</span><br><span class="line"></span><br><span class="line">    drag( d3.select( <span class="string">&quot;svg&quot;</span> ).selectAll( <span class="string">&quot;circle&quot;</span> ) );  <span class="comment">// 設定哪些元件的 drag 行為的回調函數</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ds1 = [[<span class="number">100</span>, <span class="number">100</span>, <span class="string">&quot;red&quot;</span>], [<span class="number">300</span>, <span class="number">100</span>, <span class="string">&quot;green&quot;</span>], [<span class="number">500</span>, <span class="number">100</span>, <span class="string">&quot;blue&quot;</span>]];</span><br><span class="line"></span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo04_4&#x27;</span>)</span><br><span class="line">            .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">200</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">            .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>)</span><br><span class="line">            .selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .data(ds1).enter()</span><br><span class="line">            .append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">2</span>])</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>])</span><br><span class="line">            .attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>])</span><br><span class="line">            .attr( <span class="string">&quot;r&quot;</span>, <span class="number">20</span>);</span><br><span class="line">          makeDemo04_4()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo04_4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_4;</span><br></pre></td></tr></table></figure>
<p>初始</p>
<img src="/2022/01/29/frontend-d3-004-event/06.png" class="" title="06.png">
<p>mousedown</p>
<img src="/2022/01/29/frontend-d3-004-event/07.png" class="" title="07.png">
<p>mouseup</p>
<img src="/2022/01/29/frontend-d3-004-event/08.png" class="" title="08.png">
<p>另一種更常見的寫法是直接選好元件並使用 call() 方式設定並實作 :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> widget = <span class="literal">undefined</span>, color = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">    d3.select( <span class="string">&quot;svg&quot;</span> ).selectAll( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">        .call( d3.drag()  <span class="comment">// 使用此工廠函數建立一個 drag 函數物件</span></span><br><span class="line">        .on( <span class="string">&quot;start&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// 模擬 mousedown 時的動作，取得元件</span></span><br><span class="line">            color = d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;fill&quot;</span> );  <span class="comment">// 儲存該元件的顏色，以便在 mouseup 時設回</span></span><br><span class="line">            widget = d3.select( <span class="built_in">this</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;lime&quot;</span> );  <span class="comment">// 改變該元件的顏色</span></span><br><span class="line">        &#125; )</span><br><span class="line">        .on( <span class="string">&quot;drag&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123; <span class="comment">// 模擬 mousemove</span></span><br><span class="line">            <span class="keyword">var</span> pt = d3.pointer( event, d3.select( <span class="built_in">this</span> ).node() );  <span class="comment">// 取得滑鼠座標</span></span><br><span class="line">            widget.attr( <span class="string">&quot;cx&quot;</span>, pt[<span class="number">0</span>] ).attr( <span class="string">&quot;cy&quot;</span>, pt[<span class="number">1</span>] );  <span class="comment">// 改變元件位置</span></span><br><span class="line">        &#125; )</span><br><span class="line">        .on( <span class="string">&quot;end&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// 模擬 mouseup</span></span><br><span class="line">            widget.attr( <span class="string">&quot;fill&quot;</span>, color );  <span class="comment">// 設回原來顏色</span></span><br><span class="line">            widget = <span class="literal">undefined</span>;</span><br><span class="line">        &#125; ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ds1 = [[<span class="number">100</span>, <span class="number">100</span>, <span class="string">&quot;red&quot;</span>], [<span class="number">300</span>, <span class="number">100</span>, <span class="string">&quot;green&quot;</span>], [<span class="number">500</span>, <span class="number">100</span>, <span class="string">&quot;blue&quot;</span>]];</span><br><span class="line"></span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo04_4&#x27;</span>)</span><br><span class="line">            .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">200</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">            .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>)</span><br><span class="line">            .selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .data(ds1).enter()</span><br><span class="line">            .append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">2</span>])</span><br><span class="line">            .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>])</span><br><span class="line">            .attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">1</span>])</span><br><span class="line">            .attr( <span class="string">&quot;r&quot;</span>, <span class="number">20</span>);</span><br><span class="line">          makeDemo04_4()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo04_4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_4;</span><br></pre></td></tr></table></figure>

<ul>
<li>一些注意事項</li>
</ul>
<ol>
<li>在一個 selection 實例上的重複對同一種事件使用 on()，後者會蓋掉前者的定義，可用類似 click.event1、click.event2 … 唯一的標籤防止．</li>
<li>如果想在回調函數中使用 this，則必須使用關鍵字 function 的方式宣告函數，不可用箭頭函數 <code>=&gt;</code></li>
<li>瀏覽器的行為可能會干擾你的程式，可以使用 d3.event.preventDefault()</li>
<li>只有看得見以及上了顏色的元素才會接收到滑鼠指標事件，即 visibility = hidden 或 fill 和 stroke 皆被設為 none 時．是不可以接收滑鼠事件，可使用 attr( “pointer-events”, “all” ) 方式接收</li>
<li>同理 &lt;g&gt; 元素也是不可見的，所以也可以用 attr( “pointer-events”, “all” ) 方式</li>
</ol>
<h1 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h1><p>建立及結束 Transition</p>
<ul>
<li>sel.transition( tag) : 傳回一個帶有標籤 tag 的 Transition 物件</li>
<li>sel.interrupt( tag ) : 停止帶有標籤 tag 的 Transition 物件</li>
<li>trans.transition() : 當前一個 transition 結束後就開始新的 transition</li>
<li>trans.selection() : 傳回 transition 作用的 selection</li>
</ul>
<p>對 transition 方式的設定</p>
<ul>
<li>trans.delay( value ) : value 可以為常數或是函數，可設定延遲多久後才進行 transition</li>
<li>trans.duration (value ) : value 可以為常數或是函數，可設定 transition 開始到完成的時間</li>
<li>trans.ease( function ) : 此 function 傳回值必須介於 0 ~ 1 之間，預設函數為 d3.easeCubic，改變 transition 的速率，做到類似快進慢出、慢進快出… 等效果</li>
<li>trans.on( type, handler ) : type 必須為 start、end 或 interrupt，讓 transition 在其生命週期上呼叫對應的 handler</li>
</ul>
<p>Transition 可用於 ：</p>
<ul>
<li>select()、selectAll()、filter()</li>
<li>attr()、style()、text()、each()</li>
<li>merge()、remove()、call()</li>
</ul>
<p>動態長條圖表轉換</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_5</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ds1 = [ <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span> ];</span><br><span class="line">    <span class="keyword">var</span> ds2 = [ <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span> ];</span><br><span class="line">    <span class="keyword">var</span> n = ds1.length, mx = d3.max( d3.merge( [ds1, ds2] ) );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear().domain( [<span class="number">0</span>,n] ).range( [<span class="number">50</span>,<span class="number">540</span>] );</span><br><span class="line">    <span class="keyword">var</span> scY = d3.scaleLinear().domain( [<span class="number">0</span>,mx] ).range( [<span class="number">250</span>,<span class="number">50</span>] );</span><br><span class="line"></span><br><span class="line">    svg.selectAll( <span class="string">&quot;line&quot;</span> ).data( ds1 ).enter().append( <span class="string">&quot;line&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> ).attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">20</span> )</span><br><span class="line">        .attr( <span class="string">&quot;x1&quot;</span>, <span class="function">(<span class="params">d,i</span>)=&gt;</span>scX(i) ).attr( <span class="string">&quot;y1&quot;</span>, scY(<span class="number">0</span>) )</span><br><span class="line">        .attr( <span class="string">&quot;x2&quot;</span>, <span class="function">(<span class="params">d,i</span>)=&gt;</span>scX(i) ).attr( <span class="string">&quot;y2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY(d) );</span><br><span class="line"></span><br><span class="line">    svg.on( <span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        [ ds1, ds2 ] = [ ds2, ds1 ];</span><br><span class="line">        </span><br><span class="line">        svg.selectAll( <span class="string">&quot;line&quot;</span> ).data( ds1 )</span><br><span class="line">            .transition().duration( <span class="number">1000</span> ).delay( <span class="function">(<span class="params">d,i</span>)=&gt;</span><span class="number">200</span>*i )  <span class="comment">// 設定漸變的方式</span></span><br><span class="line">            .attr( <span class="string">&quot;y2&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY(d) );  <span class="comment">// 漸變效果的最終狀態</span></span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_5</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo04_5&#x27;</span>)</span><br><span class="line">            .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">            .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">          makeDemo04_5()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo04_5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_5;</span><br></pre></td></tr></table></figure>

<h1 id="Transition-技巧"><a href="#Transition-技巧" class="headerlink" title="Transition 技巧"></a>Transition 技巧</h1><h2 id="字串切換"><a href="#字串切換" class="headerlink" title="字串切換"></a>字串切換</h2><p>想要在相同位置上切換兩字串，最好的方式就是漸變 fill-opacity 屬性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.select(<span class="string">&quot;#t1&quot;</span>).transition().duration(<span class="number">2000</span>).attr( <span class="string">&quot;fill-opacity&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    d3.select(<span class="string">&quot;#t2&quot;</span>).transition().duration(<span class="number">2000</span>).attr( <span class="string">&quot;fill-opacity&quot;</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_7</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          makeDemo04_7()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">width</span>=<span class="string">&quot;600&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">lightgrey</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">id</span>=<span class="string">&quot;t1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y</span> = <span class="string">&quot;100&quot;</span> <span class="attr">fill-opacity</span>=<span class="string">&quot;1&quot;</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">id</span>=<span class="string">&quot;t2&quot;</span> <span class="attr">x</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y</span> = <span class="string">&quot;100&quot;</span> <span class="attr">fill-opacity</span>=<span class="string">&quot;0&quot;</span>&gt;</span>Steven<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_7;</span><br></pre></td></tr></table></figure>

<h2 id="Transition-Chain"><a href="#Transition-Chain" class="headerlink" title="Transition Chain"></a>Transition Chain</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.select(<span class="string">&quot;circle&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        d3.select(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .transition().duration(<span class="number">1500</span>).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span>)</span><br><span class="line">            .transition().duration(<span class="number">1500</span>).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;blue&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          makeDemo04_8()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">lightgrey</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">circle</span> <span class="attr">r</span>=<span class="string">&quot;50&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;100&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;100&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;green&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_8;</span><br></pre></td></tr></table></figure>

<h2 id="明確配置初始值"><a href="#明確配置初始值" class="headerlink" title="明確配置初始值"></a>明確配置初始值</h2><p>要漸變目標的初始值必須是明確的<font color="#FF000">不可以使用預設值</font>，否則預設的插補器會有問題．</p>
<h2 id="自訂插補器"><a href="#自訂插補器" class="headerlink" title="自訂插補器"></a>自訂插補器</h2><p>使用 ease() 製作自訂補插器<br>設定自訂補插器的方法</p>
<ul>
<li>trans.attrTween( name, factory ) : 自訂屬性名稱為 name 的插補器，factory 為傳回插補器函數的方法</li>
<li>trans.styleTween( name, factory ) : 自訂樣式名稱為 name 的插補器，factory 為傳回插補器函數的方法</li>
<li>trans.tween( tag, factory ) : 自訂標籤名稱為 tag 的插補器，factory 為傳回插補器函數的方法<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_9</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.select(<span class="string">&quot;svg&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        d3.select(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .transition().duration(<span class="number">2000</span>).ease( <span class="function"><span class="params">t</span>=&gt;</span>t )</span><br><span class="line">            .attrTween( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="function"><span class="params">t</span>=&gt;</span><span class="string">&quot;hsl(&quot;</span>+<span class="number">360</span>*t+<span class="string">&quot;, 100%, 50%)&quot;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        d3.select(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .transition().duration(<span class="number">2000</span>).ease( <span class="function"><span class="params">t</span>=&gt;</span>t )</span><br><span class="line">            .attrTween( <span class="string">&quot;transform&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="function"><span class="params">t</span>=&gt;</span><span class="string">&quot;rotate(&quot;</span>+<span class="number">360</span>*t+<span class="string">&quot;,200,200)&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_9</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          makeDemo04_9()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;400&quot;</span> <span class="attr">width</span>=<span class="string">&quot;400&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">lightgrey</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">circle</span> <span class="attr">r</span>=<span class="string">&quot;50&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;200&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;200&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;white&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">&quot;280&quot;</span> <span class="attr">y</span>=<span class="string">&quot;280&quot;</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span> <span class="attr">height</span>=<span class="string">&quot;40&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_9;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Transition-事件"><a href="#Transition-事件" class="headerlink" title="Transition 事件"></a>Transition 事件</h2><p>透過 trans.on( type, handler ) : type 必須為 start、end 或 interrupt，讓 transition 在其生命週期上呼叫對應的 handler</p>
<h2 id="不要過度使用-transition"><a href="#不要過度使用-transition" class="headerlink" title="不要過度使用 transition"></a>不要過度使用 transition</h2><p>當 transition 用來讓使用者追蹤轉變過程是可被接受的，如果只是為了展現效果，久了就會被使用者厭煩．</p>
<h1 id="使用計時器建立動畫效果"><a href="#使用計時器建立動畫效果" class="headerlink" title="使用計時器建立動畫效果"></a>使用計時器建立動畫效果</h1><p>計時器相關的函數</p>
<ul>
<li><p>d3.timer( callback, after, start ) : 傳回一個新的計時器，會在每個動畫框中呼叫一次 callback，呼叫 callback 時會將計時器啟動到現在經過的時間傳入，此經過時間在視窗或分頁處於背景時是不計時的，start 為開始計時時間，after 為觸發計時後延遲多久呼叫 callback</p>
</li>
<li><p>d3.timeout( callback, after, start ) : 類似 timer，只是會被呼叫一次</p>
</li>
<li><p>d3.interval( callback, interval, start ) : 類似 timer，只是會間隔 interval 便呼叫一次</p>
</li>
<li><p>t.stop() : 停止 timer</p>
</li>
<li><p>d3.now() : 傳回目前時間</p>
</li>
<li><p>Lissajous Curve<br>範例出處 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/events.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/events.js</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo04_10</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">3.2</span>, b = <span class="number">5.9</span>;                 <span class="comment">// Lissajous frequencies</span></span><br><span class="line">    <span class="keyword">var</span> phi, omega = <span class="number">2</span>*<span class="built_in">Math</span>.PI/<span class="number">10000</span>;     <span class="comment">// 10 seconds per period</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> crrX = <span class="number">150</span>+<span class="number">100</span>, crrY = <span class="number">150</span>+<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> prvX = crrX, prvY = crrY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> timer = d3.timer( <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">        phi = omega*t;</span><br><span class="line"></span><br><span class="line">        crrX = <span class="number">150</span>+<span class="number">100</span>*<span class="built_in">Math</span>.cos(a*phi);</span><br><span class="line">        crrY = <span class="number">150</span>+<span class="number">100</span>*<span class="built_in">Math</span>.sin(b*phi);</span><br><span class="line"></span><br><span class="line">        svg.selectAll( <span class="string">&quot;line&quot;</span> )</span><br><span class="line">            .each( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">this</span>.bogus_opacity *= <span class="number">.99</span> &#125; )</span><br><span class="line">            .attr( <span class="string">&quot;stroke-opacity&quot;</span>,</span><br><span class="line">                   <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">this</span>.bogus_opacity &#125; )</span><br><span class="line">            .filter( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">this</span>.bogus_opacity&lt;<span class="number">0.05</span> &#125; )</span><br><span class="line">            .remove(); </span><br><span class="line">        </span><br><span class="line">        svg.append( <span class="string">&quot;line&quot;</span> )</span><br><span class="line">            .each( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">this</span>.bogus_opacity = <span class="number">1.0</span> &#125; )</span><br><span class="line">            .attr( <span class="string">&quot;x1&quot;</span>, prvX ).attr( <span class="string">&quot;y1&quot;</span>, prvY ) </span><br><span class="line">            .attr( <span class="string">&quot;x2&quot;</span>, crrX ).attr( <span class="string">&quot;y2&quot;</span>, crrY )</span><br><span class="line">            .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;green&quot;</span> ).attr( <span class="string">&quot;stroke-width&quot;</span>, <span class="number">2</span> );</span><br><span class="line"></span><br><span class="line">        prvX = crrX;</span><br><span class="line">        prvY = crrY;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>( t &gt; <span class="number">120e3</span> ) &#123; timer.stop(); &#125; <span class="comment">// after 120 seconds</span></span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo04_10</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          makeDemo04_10()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">height</span>=<span class="string">&quot;400&quot;</span> <span class="attr">width</span>=<span class="string">&quot;400&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span>&quot;<span class="attr">background</span>&quot; <span class="attr">:</span> &#x27;<span class="attr">lightgrey</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo04_10;</span><br></pre></td></tr></table></figure></li>
<li><p>Voter model<br>因為一般來說資料都需要透過網路與遠端伺服器連線取得，所以需要做一些非同步的處理，而且變化資料時加入 transition 和 duration，讓資料更新可以平順地，以提高使用者體驗<br>範例出處 : <a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient/blob/master/examples/events.js">https://github.com/janert/d3-for-the-impatient/blob/master/examples/events.js</a><br>```js<br>import * as d3 from ‘d3’<br>import { useEffect } from ‘react’;</p>
</li>
</ul>
<p>function makeDemo04_11() {<br>    var n = 50, w=300/n, dt = 3000, svg = d3.select( “svg” );</p>
<pre><code>var data = d3.range(n*n)                                      //&lt;1&gt;
    .map( d =&gt; &#123; return &#123; x: d%n, y: d/n|0,
                          val: Math.random() &#125; &#125; ); 

var sc = d3.scaleQuantize()                                   //&lt;2&gt;
    .range( [ &quot;white&quot;, &quot;red&quot;, &quot;black&quot; ] );  

svg.selectAll( &quot;rect&quot; ).data( data ).enter().append( &quot;rect&quot; ) //&lt;3&gt;
    .attr( &quot;x&quot;, d=&gt;w*d.x ).attr( &quot;y&quot;, d=&gt;w*d.y )
    .attr( &quot;width&quot;, w-1 ).attr( &quot;height&quot;, w-1 )
    .attr( &quot;fill&quot;, d =&gt; sc(d.val) );

function update() &#123;                                           //&lt;4&gt;
    var nbs = [ [0,1], [0,-1], [ 1,0], [-1, 0],
                [1,1], [1,-1], [-1,1], [-1,-1] ];
    return d3.shuffle( d3.range( n*n ) ).map( i =&gt; &#123;
        var nb = nbs[ nbs.length*Math.random() | 0 ];
        var x = (data[i].x + nb[0] + n)%n;
        var y = (data[i].y + nb[1] + n)%n;
        data[i].val = data[ y*n + x ].val;
    &#125; );
&#125;

d3.interval( function() &#123;                                     //&lt;5&gt;
    update();
    svg.selectAll( &quot;rect&quot; ).data( data )
        .transition().duration(dt).delay((d,i)=&gt;i*0.25*dt/(n*n))
        .attr( &quot;fill&quot;, d =&gt; sc(d.val) ) &#125;, dt );
</code></pre>
<p>}</p>
<p>function Demo04_11() {<br>    useEffect(()=&gt;{<br>          makeDemo04_11()<br>      })</p>
<pre><code>return (
    (&lt;svg height=&quot;300&quot; width=&quot;300&quot; style=&#123;&#123;"background" : 'lightgrey'&#125;&#125;&gt;
    &lt;/svg&gt;)
);
</code></pre>
<p>}</p>
<p>export default Demo04_11;<br>``</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/27/frontend-d3-003-selection-and-binding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/27/frontend-d3-003-selection-and-binding/" class="post-title-link" itemprop="url">D3 - 003 選擇元素與繫結資料</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-27 21:57:38" itemprop="dateCreated datePublished" datetime="2022-01-27T21:57:38+08:00">2022-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-08 16:17:13" itemprop="dateModified" datetime="2022-02-08T16:17:13+08:00">2022-02-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>6 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Selection"><a href="#Selection" class="headerlink" title="Selection"></a>Selection</h1><p>可利用 d3 物件上的 select(selector) 取得第一個匹配 selector 的元素；利用 selectAll(selector) 取得所有匹配 selector 的元素．<br>selector 是為 CSS 選擇器字串，底下是幾個不同類型的選擇器 :</p>
<ol>
<li>type<br>由標籤名稱所組成，像是 p 或 svg，也有一個萬用選擇器 *，常用來選則某一選擇器的所有後代，如 : div *</li>
<li>#id<br>使用元素的 id 值來選取元素</li>
<li>.calss<br>使用元素的 class 值來選取元素</li>
<li>:pseudo-class<br>以元素的狀態或位置來選取，如 : :hover、:visited、:first-child … 等</li>
<li>[attribute]<br>根據擁有的屬性或屬性值來選取，如 : [width] 表示選取具有屬性 width 的元素；[width=600] 表示選取具有屬性 width 且值為 600 的元素．<br>雖然以上選擇器也可以組合，讓我們可以有更豐富的方式選擇元素，不過對 D3 比較重要的是 type 和 ID 選擇器的組合，而 :pseudo-class 選擇器對 D3 也是蠻常用到的，而組合式選擇器對 D3 而言，比較會使用 d3.selectAll(“p”).selectAll(“b”) 的方式取代．<br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/CSS/CSS_Selectors">CSS Selectors</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/CSS/Pseudo-classes">Pseudo classes</a></li>
</ol>
<h1 id="繫結資料"><a href="#繫結資料" class="headerlink" title="繫結資料"></a>繫結資料</h1><p>data() 接受任意資料的陣列或物件，然後嘗試在目前的選取到的元素集合上，建立陣列項目與元素間一對一關係．<br>除非有提供 key，否則陣列與元素集合是依據順序對應，陣列大小與元素個數並非一定要相等．<br>如果資料已經繫結到元素了，則會被儲存到元素的 <strong>data</strong> 屬性中，除非被明確地被覆寫 (將另一個資料集傳入 data() 中)，否則資料會一直被儲存在元素中．</p>
<ol>
<li>元素個數 = 資料個數<img src="/2022/01/27/frontend-d3-003-selection-and-binding/01.png" class="" title="01.png">
data() 取出有對應到的元素集合</li>
<li>元素個數 &lt; 資料個數<img src="/2022/01/27/frontend-d3-003-selection-and-binding/02.png" class="" title="02.png">
enter() 取出沒有對應到的空集合，然後可以用 &lt;append&gt; 添加元素，<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.select( <span class="string">&quot;svg&quot;</span> ).selectAll( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">    .data( data ).enter()</span><br><span class="line">    .append(<span class="string">&quot;circle&quot;</span>).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span> );</span><br></pre></td></tr></table></figure></li>
<li>元素個數 &gt; 資料個數<img src="/2022/01/27/frontend-d3-003-selection-and-binding/03.png" class="" title="03.png">
exit() 取出沒有資料綁定的元素，然後可以用 &lt;remove&gt; 移除元素，<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.select( <span class="string">&quot;svg&quot;</span> ).selectAll( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">    .data( data ).exit()</span><br><span class="line">    .remove();</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="透過-key-更新資料"><a href="#透過-key-更新資料" class="headerlink" title="透過 key 更新資料"></a>透過 key 更新資料</h1><p>data( data, key) : data 為資料集，key 為更新所依據的鍵值<br>若與之前的資料集有差異的話，其更新情況如下 :</p>
<img src="/2022/01/27/frontend-d3-003-selection-and-binding/04.png" class="" title="04.png">
<p>若資料集有重複的 key 時，更新情況如下，重複的會被放在 enter() 中 :</p>
<img src="/2022/01/27/frontend-d3-003-selection-and-binding/05.png" class="" title="05.png">
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo03_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ds1 = [[<span class="string">&quot;Steven&quot;</span>, <span class="number">1</span>], [<span class="string">&quot;Amy&quot;</span>, <span class="number">5</span>], [<span class="string">&quot;Eric&quot;</span>, <span class="number">9</span>]];</span><br><span class="line">    <span class="keyword">var</span> ds2 = [[<span class="string">&quot;Eric&quot;</span>, <span class="number">3</span>], [<span class="string">&quot;Amy&quot;</span>, <span class="number">7</span>]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear().domain([<span class="number">0</span>, <span class="number">10</span>]).range([<span class="number">50</span>, <span class="number">550</span>]),</span><br><span class="line">        scY = d3.scaleLinear().domain([<span class="number">0</span>, <span class="number">3</span>]).range([<span class="number">30</span>, <span class="number">120</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line"></span><br><span class="line">    svg.selectAll( <span class="string">&quot;text&quot;</span> )  <span class="comment">// d3 會返回一個空集合</span></span><br><span class="line">        .data(ds1).enter().append( <span class="string">&quot;text&quot;</span> )  <span class="comment">// 繫結資料並以 &lt;text&gt; 填充</span></span><br><span class="line">        .attr( <span class="string">&quot;x&quot;</span>, <span class="number">20</span> ).attr( <span class="string">&quot;y&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY(j++) ).text( <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>] );  <span class="comment">// 設定外觀</span></span><br><span class="line">    </span><br><span class="line">    svg.selectAll(<span class="string">&quot;circle&quot;</span>).data(ds1).enter().append( <span class="string">&quot;circle&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span> )</span><br><span class="line">        .attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scX(d[<span class="number">1</span>]) ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY(k++)-<span class="number">5</span> );</span><br><span class="line"></span><br><span class="line">    svg.on( <span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> cs = svg.selectAll( <span class="string">&quot;circle&quot;</span> ).data( ds2, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">0</span>] );  <span class="comment">// 用 ds2 更新資料，並以 d[0] (&quot;Eric&quot; 和 &quot;Amy&quot;) 為 key 值更新</span></span><br><span class="line"></span><br><span class="line">        cs.transition().duration(<span class="number">1000</span>).attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scX(d[<span class="number">1</span>]) );  <span class="comment">// 移動圓點</span></span><br><span class="line">        cs.exit().attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;blue&quot;</span> );  <span class="comment">// 取剩下沒有繫結到的元素 (&quot;Steven&quot;) 設定外觀 </span></span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo03_1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo03_1&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">120</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">          .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">          makeDemo03_1()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo03_1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo03_1;</span><br></pre></td></tr></table></figure>
<p>初始</p>
<img src="/2022/01/27/frontend-d3-003-selection-and-binding/06.png" class="" title="06.png">
<p>點擊後</p>
<img src="/2022/01/27/frontend-d3-003-selection-and-binding/07.png" class="" title="07.png">


<h1 id="一般更新流程"><a href="#一般更新流程" class="headerlink" title="一般更新流程"></a>一般更新流程</h1><p>一般情況下，不可能資料都是一直準備好不動的，有可能因為使用者輸入了一個新資料而必須新增一個元素，所以一個新增元素並將他合併回原本的元素集的流程是必需的，步驟如下 :</p>
<ol>
<li>繫結 (data()) 新的資料到現存的元素集</li>
<li>移除不再連結的元素 (exit()remove())</li>
<li>因為新增資料而沒有連結到元素必須建立並配置新元素 (enter().append())</li>
<li>將新建的元素合併回原始的元素集 (merge())</li>
<li>配置合併完成後元素集的外觀<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo03_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ds1 = [ [<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;red&quot;</span>], [<span class="number">1</span>, <span class="number">4</span>, <span class="string">&quot;yellow&quot;</span>], [<span class="number">4</span>, <span class="number">1</span>, <span class="string">&quot;green&quot;</span>],</span><br><span class="line">                [<span class="number">4</span>, <span class="number">4</span>, <span class="string">&quot;blue&quot;</span>] ];    </span><br><span class="line">    <span class="keyword">var</span> ds2 = [ [<span class="number">4</span>, <span class="number">4</span>, <span class="string">&quot;red&quot;</span>], [<span class="number">3</span>, <span class="number">3</span>, <span class="string">&quot;black&quot;</span>], [<span class="number">2</span>, <span class="number">2</span>, <span class="string">&quot;lime&quot;</span>],</span><br><span class="line">                [<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;blue&quot;</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> scX = d3.scaleLinear().domain([<span class="number">1</span>, <span class="number">4</span>]).range([<span class="number">50</span>, <span class="number">250</span>]);</span><br><span class="line">    <span class="keyword">var</span> scY = d3.scaleLinear().domain([<span class="number">1</span>, <span class="number">4</span>]).range([<span class="number">50</span>, <span class="number">250</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line">    </span><br><span class="line">    svg.on( <span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        [ ds1, ds2 ] = [ ds2, ds1 ];  <span class="comment">// 置換資料集</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> cs = svg.selectAll( <span class="string">&quot;circle&quot;</span> ).data( ds1, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">2</span>] );  <span class="comment">// 1. 第一次將會建立空集合，第二次會根據 key 更新元素集</span></span><br><span class="line">        </span><br><span class="line">        cs.exit().remove();  <span class="comment">// 2. 移除多餘的元素</span></span><br><span class="line">        </span><br><span class="line">        cs = cs.enter().append( <span class="string">&quot;circle&quot;</span> )  <span class="comment">// 3. 建立新的元素</span></span><br><span class="line">            .attr( <span class="string">&quot;r&quot;</span>, <span class="number">5</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="number">2</span>] )  <span class="comment">// 3. 配置新元素外觀</span></span><br><span class="line">            .merge( cs );  <span class="comment">// 4. 合併回原本的元素集</span></span><br><span class="line"></span><br><span class="line">        cs.attr( <span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scX(d[<span class="number">0</span>]) ).attr( <span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY(d[<span class="number">1</span>]) );  <span class="comment">// 5. 調整外觀</span></span><br><span class="line">    &#125; );</span><br><span class="line">    </span><br><span class="line">    svg.dispatch( <span class="string">&quot;click&quot;</span> );  <span class="comment">// 因為一開始並沒有建立圓點，所以必須觸發一次 click 以便可以進行圓點的繪製</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo03_2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo03_2&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">          makeDemo03_2()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo03_2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo03_2;</span><br></pre></td></tr></table></figure>
初始<img src="/2022/01/27/frontend-d3-003-selection-and-binding/08.png" class="" title="08.png">
點擊後<img src="/2022/01/27/frontend-d3-003-selection-and-binding/09.png" class="" title="09.png"></li>
</ol>
<h1 id="selection-的一些操作"><a href="#selection-的一些操作" class="headerlink" title="selection 的一些操作"></a>selection 的一些操作</h1><ul>
<li>sel.attr(name, value) : set attribute</li>
<li>sel.style(name, value, priority) : set style</li>
<li>sel.property(name, value) : set property<br>value 可以是一個值<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sel.attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span>)</span><br></pre></td></tr></table></figure>
也可以是一個函數<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sel.attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d, i, ns</span>) </span>&#123; <span class="keyword">return</span> d&lt;<span class="number">0</span>?<span class="string">&quot;red&quot;</span>:<span class="string">&quot;green&quot;</span> &#125; );</span><br></pre></td></tr></table></figure>
或是用 =&gt;<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sel.attr( <span class="string">&quot;fill&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>d&lt;<span class="number">0</span> ? <span class="string">&quot;red&quot;</span>:<span class="string">&quot;green&quot;</span>)</span><br></pre></td></tr></table></figure>
若要取得指向目前 DOM 元素本身，即使用 this，則必須使用關鍵字 function 的方式</li>
</ul>
<p>其他操作</p>
<ul>
<li><p>sel.classed(value, flag) : set class name</p>
</li>
<li><p>sel.text(value) : set &lt;text&gt; value</p>
</li>
<li><p>sel.html(value) : set inner HTML</p>
</li>
<li><p>sel.datum(value) : 將 value 綁定到該元素</p>
</li>
<li><p>sel.each(function) : 每個元素都呼叫一次 gfunction</p>
</li>
<li><p>sel.append(item) : 新增一個元素</p>
</li>
<li><p>sel.insert(item, before) : 在匹配 before 前插入一個元素</p>
</li>
<li><p>sel.merge(selection) : 合併兩個元素集</p>
</li>
<li><p>sel.remove() : 移除元素</p>
</li>
<li><p>sel.sort(comparator) : 根據 comparator 排序元素集</p>
</li>
<li><p>sel.call(function, arguments) : 呼叫一次 function</p>
</li>
<li><p>sel.nodes() : 以 DOM 節點陣列方式傳回所有非空值的節點</p>
</li>
<li><p>sel.node() : 以 DOM 節點陣列方式傳回第一個非空值的節點</p>
</li>
<li><p>sel.size() : 元素個數</p>
</li>
<li><p>sel.empty() : 檢查元素集中是否具有非空值元素</p>
</li>
<li><p>底下的操作會傳回新的 selection<br>select()、selectAll()<br>data()、enter()、exit()<br>append()、insert()、remove()<br>merge()、filter()、sort()<br>create()</p>
</li>
</ul>
<h1 id="插入元素並排序"><a href="#插入元素並排序" class="headerlink" title="插入元素並排序"></a>插入元素並排序</h1><p>使用 insert() 插入新元素後，使用 datum() 繫結元素，而使用 sort() 可針對選取出的元素集做排序</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo03_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = [ <span class="string">&quot;Steven&quot;</span>, <span class="string">&quot;Amy&quot;</span>, <span class="string">&quot;Eric&quot;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ul = d3.select( <span class="string">&quot;ul&quot;</span> );</span><br><span class="line">    ul.selectAll( <span class="string">&quot;li&quot;</span> )</span><br><span class="line">        .data( data ).enter().append( <span class="string">&quot;li&quot;</span> )</span><br><span class="line">        .text( <span class="function"><span class="params">d</span>=&gt;</span>d ); <span class="comment">// &lt;li&gt;text&lt;/li&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> done;</span><br><span class="line">    ul.on( <span class="string">&quot;mouseenter&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// 當滑鼠移進 &lt;ul&gt; 時</span></span><br><span class="line">        <span class="keyword">if</span>( done ) &#123; <span class="keyword">return</span>; &#125;  <span class="comment">// 若已經移進過了就直接返回</span></span><br><span class="line">        done = <span class="number">1</span>;</span><br><span class="line">        ul.insert( <span class="string">&quot;li&quot;</span>, <span class="string">&quot;:nth-child(2)&quot;</span> )  <span class="comment">// 將 &lt;li&gt; 插入第二個元素 (Amy) 之前</span></span><br><span class="line">            .datum( <span class="string">&quot;Oscar&quot;</span> ).text( <span class="string">&quot;Oscar&quot;</span> );  <span class="comment">// 只會繫結 Oscar 這筆資料到所選的元素上</span></span><br><span class="line">        ul.insert( <span class="string">&quot;li&quot;</span>, <span class="string">&quot;:first-child&quot;</span> )</span><br><span class="line">            .datum( <span class="string">&quot;Rose&quot;</span> ).text( <span class="string">&quot;Rose&quot;</span> );</span><br><span class="line">    &#125; );</span><br><span class="line">        </span><br><span class="line">    ul.on( <span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        ul.selectAll( <span class="string">&quot;li&quot;</span> ).sort( <span class="function">(<span class="params">a,b</span>)=&gt;</span>( a&lt;b?<span class="number">1</span>:b&lt;a?-<span class="number">1</span>:<span class="number">0</span> ) );  <span class="comment">// 選擇所有 &lt;li&gt; 元素進行排序</span></span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo03_3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo03_3&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;ul&#x27;</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">          makeDemo03_3()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo03_3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo03_3;</span><br></pre></td></tr></table></figure>
<p>初始</p>
<img src="/2022/01/27/frontend-d3-003-selection-and-binding/10.png" class="" title="10.png">
<p>插入元素</p>
<img src="/2022/01/27/frontend-d3-003-selection-and-binding/11.png" class="" title="11.png">
<p>排序元素</p>
<img src="/2022/01/27/frontend-d3-003-selection-and-binding/12.png" class="" title="12.png">

<h1 id="節點選取"><a href="#節點選取" class="headerlink" title="節點選取"></a>節點選取</h1><p>比如說有個 Html 如下 :</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>A<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>B<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>C<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>D<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果我們使用底下方式選取</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">&quot;tr&quot;</span>).selectAll(<span class="string">&quot;td&quot;</span>).attr(..., (d, i, ns));</span><br></pre></td></tr></table></figure>
<p>則可以想成取回所有的 &lt;tr&gt; 元素集，並且又取出第一個 &lt;tr&gt; 下的所有 &lt;td&gt;，所以 i 只有 0 和 1，ns 也只會有兩個．<br>但是如果用底下方式取 :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ds.selectAll(<span class="string">&quot;td&quot;</span>).attr(..., (d, i, ns));</span><br></pre></td></tr></table></figure>
<p>則表示取出文件中的四個 &lt;td&gt; 元素，i = 0, 1, 2, 3，且 ns 會有四個</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/27/backend-spring-security-004-remember-me/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/27/backend-spring-security-004-remember-me/" class="post-title-link" itemprop="url">Spring Security Notes - 004 Remember Me</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-01-27 14:38:01 / Modified: 17:29:53" itemprop="dateCreated datePublished" datetime="2022-01-27T14:38:01+08:00">2022-01-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring-Security/" itemprop="url" rel="index"><span itemprop="name">Spring Security</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="開啟-Remember-Me"><a href="#開啟-Remember-Me" class="headerlink" title="開啟 Remember Me"></a>開啟 Remember Me</h1><p>在設定中打開 Remember Me 功能，並且先使用預設的驗證進入點<br>src/main/java/tw/com/pluto/config/MyWebSecurityConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http</span><br><span class="line">                ...</span><br><span class="line">                <span class="comment">//.authenticationEntryPoint(myAuthenticationEntryPoint).and()</span></span><br><span class="line">                ...</span><br><span class="line">                .rememberMe();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到預設的登入頁面除了可輸入使用者名稱和密碼之外，多了一個 Remember Me 的 Check Box 可勾選</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/01.png" class="" title="01.png">
<p>此時如果輸入使用者名稱和密碼後，並勾選 Remember Me，則會發生底下錯誤</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/02.png" class="" title="02.png">
<p>這是因為登入成功後，因為安全機制會將密碼清除，所以 Remember Me 服務將會使用 UserDetailsService 重新取得密碼，所以我們也必須要設定使用哪個 UserDetailsService<br>src/main/java/tw/com/pluto/config/MyWebSecurityConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyUserDetailsService myUserDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http</span><br><span class="line">                </span><br><span class="line">                .rememberMe()</span><br><span class="line">                .userDetailsService(myUserDetailsService);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次輸入使用者名稱和密碼後，並勾選 Remember Me，則會可以看到底下的資訊，知道除了傳遞參數 username 及 password 外，還多了一個參數 remember-me</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/03.png" class="" title="03.png">
<p>而且後端也會傳回一個新 cookie 名為 remember-me</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/04.png" class="" title="04.png">
<p>當我們另開一個瀏覽器頁面並連線到後端時，瀏覽器會帶上剛剛的 cookie (remember-me)，所以後端就會讓此請求通行</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/05.png" class="" title="05.png">
<p>但是當我們後端重新啟動後，再次連上後端，可以發現後端已經不認得此 cookie (remember-me) 了，這是因為我們並沒有一個持久化儲存機制。</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/06.png" class="" title="06.png">

<h1 id="使用-MySQL-儲存-remember-me"><a href="#使用-MySQL-儲存-remember-me" class="headerlink" title="使用 MySQL 儲存 remember-me"></a>使用 MySQL 儲存 remember-me</h1><p>使用 Spring Security 預設的 JdbcTokenRepositoryImpl 類別，我們需要先建立一個 beean 並請設置 DataSource，設定使用 jdbcTokenRepository 儲存 remember-me 資訊<br>src/main/java/tw/com/pluto/config/MyWebSecurityConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.rememberme.JdbcTokenRepositoryImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">JdbcTokenRepositoryImpl <span class="title">jdbcTokenRepository</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JdbcTokenRepositoryImpl jdbcTokenRepository = <span class="keyword">new</span> JdbcTokenRepositoryImpl();</span><br><span class="line">        jdbcTokenRepository.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> jdbcTokenRepository;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http</span><br><span class="line">                ...</span><br><span class="line">                .rememberMe()</span><br><span class="line">                .userDetailsService(myUserDetailsService)</span><br><span class="line">                .tokenRepository(jdbcTokenRepository());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根據底下 JdbcTokenRepositoryImpl 的原始碼可以知道需要一個資料表名為 persistent_logins，有四個欄位 username、series、token 及 last_used</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTokenRepositoryImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">PersistentTokenRepository</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CREATE_TABLE_SQL = <span class="string">&quot;create table persistent_logins (username varchar(64) not null, series varchar(64) primary key, token varchar(64) not null, last_used timestamp not null)&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_TOKEN_BY_SERIES_SQL = <span class="string">&quot;select username,series,token,last_used from persistent_logins where series = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_INSERT_TOKEN_SQL = <span class="string">&quot;insert into persistent_logins (username, series, token, last_used) values(?,?,?,?)&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_UPDATE_TOKEN_SQL = <span class="string">&quot;update persistent_logins set token = ?, last_used = ? where series = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEF_REMOVE_USER_TOKENS_SQL = <span class="string">&quot;delete from persistent_logins where username = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String tokensBySeriesSql = <span class="string">&quot;select username,series,token,last_used from persistent_logins where series = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String insertTokenSql = <span class="string">&quot;insert into persistent_logins (username, series, token, last_used) values(?,?,?,?)&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String updateTokenSql = <span class="string">&quot;update persistent_logins set token = ?, last_used = ? where series = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String removeUserTokensSql = <span class="string">&quot;delete from persistent_logins where username = ?&quot;</span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>所以我們建立一個 SQL Script<br>src/main/resources/remember_me.txt</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `persistent_logins` (</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `series` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `token` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `last_used` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`series`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>
<p>在資料庫中建立該資料表</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/07.png" class="" title="07.png">
<p>此時我們重新啟動伺服器進行登入，可以發現資料庫中將會有一筆紀錄</p>
<img src="/2022/01/27/backend-spring-security-004-remember-me/08.png" class="" title="08.png">
<p>此時就算後端重新啟動也不會需要再重新登入</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/23/frontend-d3-002-installing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Steven Wu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Steven 的學習筆記">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/23/frontend-d3-002-installing/" class="post-title-link" itemprop="url">D3 - 003 D3 安裝和結合 React 的小範例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-23 19:26:50" itemprop="dateCreated datePublished" datetime="2022-01-23T19:26:50+08:00">2022-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-27 11:19:10" itemprop="dateModified" datetime="2022-01-27T11:19:10+08:00">2022-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/D3/" itemprop="url" rel="index"><span itemprop="name">D3</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安裝-D3"><a href="#安裝-D3" class="headerlink" title="安裝 D3"></a>安裝 D3</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install d3 --save</span></span><br></pre></td></tr></table></figure>

<h1 id="引入並建立第一個練習"><a href="#引入並建立第一個練習" class="headerlink" title="引入並建立第一個練習"></a>引入並建立第一個練習</h1><p>在 React 的生命週期 componentDidMount 時，建立 D3</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    d3.select(<span class="string">&#x27;.App&#x27;</span>)</span><br><span class="line">      .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">      .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">200</span>)</span><br><span class="line">      .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">500</span>)</span><br><span class="line">      .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;red&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">      d3.select(test)</span><br><span class="line">      .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">      .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">200</span>)</span><br><span class="line">      .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">500</span>)</span><br><span class="line">      .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>頁面呈現結果</p>
<img src="/2022/01/23/frontend-d3-002-installing/01.png" class="" title="01.png">

<h1 id="讀取文件進行繪製"><a href="#讀取文件進行繪製" class="headerlink" title="讀取文件進行繪製"></a>讀取文件進行繪製</h1><p>首先將資料檔放在 public/data/examples-simple.tsv</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x	y</span><br><span class="line">100	50</span><br><span class="line">200	100</span><br><span class="line">300	150</span><br><span class="line">400	200</span><br><span class="line">500	250</span><br></pre></td></tr></table></figure>
<p>接著在 App.js 中讀取檔案並繪製<br>src/App.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.App&#x27;</span>)</span><br><span class="line">            .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">            .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">            .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            d3.tsv(<span class="string">&quot;data/examples-simple.tsv&quot;</span>) <span class="comment">// 讀取資料</span></span><br><span class="line">            .then( <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            d3.select(<span class="string">&quot;svg&quot;</span>) <span class="comment">// 傳回第一個匹配的點</span></span><br><span class="line">                .selectAll(<span class="string">&quot;circle&quot;</span>) <span class="comment">// 傳回所有匹配的點，在此時因為沒有找不到任何一個，所以將會建立一個空的 collection</span></span><br><span class="line">                .data(data) <span class="comment">// 將 circle 元素與資料集一對一地結合在一起</span></span><br><span class="line">                .enter() <span class="comment">// 但是並沒有任何的 circle 元素可以對應資料集，所以使用此方法讓 D3 先幫我們佔著</span></span><br><span class="line">                .append(<span class="string">&quot;circle&quot;</span>) <span class="comment">// 針對只有資料沒有元素對應的點，使用 circle 元素幫我們填充</span></span><br><span class="line">                .attr(<span class="string">&quot;r&quot;</span>, <span class="number">5</span>) <span class="comment">// 設定半徑固定為 5</span></span><br><span class="line">                .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span>) <span class="comment">// 設定填充的顏色為 red</span></span><br><span class="line">                .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;<span class="keyword">return</span> d[<span class="string">&quot;x&quot;</span>]&#125;) <span class="comment">// 取得 data 的 x 欄位來設定 cx</span></span><br><span class="line">                .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;<span class="keyword">return</span> d[<span class="string">&quot;y&quot;</span>]&#125;); <span class="comment">// 取得 data 的 y 欄位來設定 cy</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>頁面呈現結果</p>
<img src="/2022/01/23/frontend-d3-002-installing/02.png" class="" title="02.png">

<h1 id="封裝組件"><a href="#封裝組件" class="headerlink" title="封裝組件"></a>封裝組件</h1><p>將原本寫在 App 組件中的 D3 程式碼，封裝到另一個組件 Demo1 中<br>src/components/Demo1/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo1&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">          .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">          d3.tsv(<span class="string">&quot;examples-simple.tsv&quot;</span>) <span class="comment">// 讀取資料</span></span><br><span class="line">            .then( <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            d3.select(<span class="string">&quot;svg&quot;</span>) <span class="comment">// 傳回第一個匹配的點</span></span><br><span class="line">              .selectAll(<span class="string">&quot;circle&quot;</span>) <span class="comment">// 傳回所有匹配的點，在此時因為沒有找不到任何一個，所以將會建立一個空的 collection</span></span><br><span class="line">              .data(data) <span class="comment">// 將 circle 元素與資料集一對一地結合在一起</span></span><br><span class="line">              .enter() <span class="comment">// 但是並沒有任何的 circle 元素可以對應資料集，所以使用此方法讓 D3 先幫我們佔著</span></span><br><span class="line">              .append(<span class="string">&quot;circle&quot;</span>) <span class="comment">// 針對只有資料沒有元素對應的點，使用 circle 元素幫我們填充</span></span><br><span class="line">              .attr(<span class="string">&quot;r&quot;</span>, <span class="number">5</span>) <span class="comment">// 設定半徑固定為 5</span></span><br><span class="line">              .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;red&quot;</span>) <span class="comment">// 設定填充的顏色為 red</span></span><br><span class="line">              .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;<span class="keyword">return</span> d[<span class="string">&quot;x&quot;</span>]&#125;) <span class="comment">// 取得 data 的 x 欄位來設定 cx</span></span><br><span class="line">              .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;<span class="keyword">return</span> d[<span class="string">&quot;y&quot;</span>]&#125;); <span class="comment">// 取得 data 的 y 欄位來設定 cy</span></span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>
<p>修改 App.js，引入組件 Demo1<br>src/App.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Demo1 <span class="keyword">from</span> <span class="string">&#x27;./components/Demo1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Demo1</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>頁面呈現結果</p>
<img src="/2022/01/23/frontend-d3-002-installing/03.png" class="" title="03.png">

<h1 id="使用兩個資料集"><a href="#使用兩個資料集" class="headerlink" title="使用兩個資料集"></a>使用兩個資料集</h1><p>使用 public/data/examples-multiple.tsv 當資料集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">x	y1	    y2</span><br><span class="line">1.0	0.001	0.63</span><br><span class="line">3.0	0.003	0.84</span><br><span class="line">4.0	0.024	0.56</span><br><span class="line">4.5	0.054	0.22</span><br><span class="line">4.6	0.062	0.15</span><br><span class="line">5.0	0.100	0.08</span><br><span class="line">6.0	0.176	0.20</span><br><span class="line">8.0	0.198	0.71</span><br><span class="line">9.0	0.199	0.65</span><br></pre></td></tr></table></figure>
<p>建立 Ｄemo2 組件<br>src/components/Demo2/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo2&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">          .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">          d3.tsv(<span class="string">&quot;data/examples-multiple.tsv&quot;</span>) <span class="comment">// 讀取資料</span></span><br><span class="line">            .then( <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">var</span> pxX = <span class="number">600</span>, pxY = <span class="number">300</span>; <span class="comment">// 設定 SVG 區域大小</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用線性縮放，將 domain 映射到 range 中，</span></span><br><span class="line">            <span class="comment">// 也就說是將資料中的值，依據 SVG 尺寸來做線性縮放</span></span><br><span class="line">            <span class="keyword">var</span> scX = d3.scaleLinear()</span><br><span class="line">              .domain(d3.extent(data, <span class="function"><span class="params">d</span> =&gt;</span> d[<span class="string">&quot;x&quot;</span>])) <span class="comment">// extent() : 傳回 data 的 x 欄位中的最小值及最大值，以 [min, max] 形式傳回</span></span><br><span class="line">              .range([<span class="number">0</span>, pxX]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> scY1 = d3.scaleLinear()</span><br><span class="line">              .domain(d3.extent(data, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="string">&quot;y1&quot;</span>]))</span><br><span class="line">              .range([pxY, <span class="number">0</span>]) <span class="comment">// 因為座標原點在左上角，越往下越大，所以我們故意反轉來做修正</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> scY2 = d3.scaleLinear()</span><br><span class="line">              .domain(d3.extent(data, <span class="function"><span class="params">d</span>=&gt;</span>d[<span class="string">&quot;y2&quot;</span>]))</span><br><span class="line">              .range([pxY, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">            d3.select(<span class="string">&quot;svg&quot;</span>) <span class="comment">// 傳回第一個匹配的點</span></span><br><span class="line">              .append(<span class="string">&quot;g&quot;</span>) <span class="comment">// 建立一個邏輯分組後，才把圖形元素加入其中</span></span><br><span class="line">              .attr(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;ds1&quot;</span>) <span class="comment">// 設定唯一標識</span></span><br><span class="line">              .selectAll(<span class="string">&quot;circle&quot;</span>) <span class="comment">// 在分組(ds1)中的子元素建立空的 circle collection</span></span><br><span class="line">              .data(data).enter().append(<span class="string">&quot;circle&quot;</span>) <span class="comment">// 將 data 套用到 circle 元素</span></span><br><span class="line">              .attr(<span class="string">&quot;r&quot;</span>, <span class="number">5</span>) <span class="comment">// 設定半徑固定為 5</span></span><br><span class="line">              .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;green&quot;</span>) <span class="comment">// 設定 &lt;g&gt; 元素的填充顏色為 green，也會一併套用到子元素中</span></span><br><span class="line">              .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scX(d[<span class="string">&quot;x&quot;</span>])) <span class="comment">// 此處是取得縮放過後的 x 值</span></span><br><span class="line">              .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY1(d[<span class="string">&quot;y1&quot;</span>])); <span class="comment">// 此處是取得縮放過後的 y1 值</span></span><br><span class="line"></span><br><span class="line">            d3.select(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">              .append(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">              .attr(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;ds2&quot;</span>)</span><br><span class="line">              .selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">              .data(data).enter().append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">              .attr(<span class="string">&quot;r&quot;</span>, <span class="number">5</span>)</span><br><span class="line">              .attr(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;blue&quot;</span>)</span><br><span class="line">              .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scX(d[<span class="string">&quot;x&quot;</span>]))</span><br><span class="line">              .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scY2(d[<span class="string">&quot;y2&quot;</span>]));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> lineMaker = d3.line() <span class="comment">// 使用 line() 幫助我們產生 &lt;ptah&gt; 中的 d 屬性</span></span><br><span class="line">                .x( <span class="function"><span class="params">d</span> =&gt;</span> scX( d[<span class="string">&quot;x&quot;</span>] ) )</span><br><span class="line">                .y( <span class="function"><span class="params">d</span> =&gt;</span> scY1( d[<span class="string">&quot;y1&quot;</span>] ) );</span><br><span class="line">            </span><br><span class="line">            d3.select( <span class="string">&quot;#ds1&quot;</span> )  <span class="comment">// 選到 &lt;g id=&quot;ds1&quot;&gt;</span></span><br><span class="line">                .append( <span class="string">&quot;path&quot;</span> )  <span class="comment">// 添加一段路徑</span></span><br><span class="line">                .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> )  <span class="comment">// 實線</span></span><br><span class="line">                .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span> )  <span class="comment">// 顏色為 red</span></span><br><span class="line">                .attr( <span class="string">&quot;d&quot;</span>, lineMaker(data) );</span><br><span class="line">           </span><br><span class="line">            lineMaker.y( <span class="function"><span class="params">d</span> =&gt;</span> scY2( d[<span class="string">&quot;y2&quot;</span>] ) );</span><br><span class="line"></span><br><span class="line">            d3.select( <span class="string">&quot;#ds2&quot;</span> )</span><br><span class="line">                .append( <span class="string">&quot;path&quot;</span> )</span><br><span class="line">                .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> )</span><br><span class="line">                .attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;cyan&quot;</span> )</span><br><span class="line">                .attr( <span class="string">&quot;d&quot;</span>, lineMaker(data) );</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo2;</span><br></pre></td></tr></table></figure>
<p>頁面呈現結果</p>
<img src="/2022/01/23/frontend-d3-002-installing/04.png" class="" title="04.png">

<h1 id="建立可重用元件並且添加座標軸"><a href="#建立可重用元件並且添加座標軸" class="headerlink" title="建立可重用元件並且添加座標軸"></a>建立可重用元件並且添加座標軸</h1><p>將一些重複的程式碼合併成一個 function<br>src/components/Demo3/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeDemo3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    d3.tsv(<span class="string">&quot;data/examples-multiple.tsv&quot;</span>)</span><br><span class="line">        .then( <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> svg = d3.select( <span class="string">&quot;svg&quot;</span> );</span><br><span class="line">            <span class="keyword">var</span> pxX = svg.attr( <span class="string">&quot;width&quot;</span> );</span><br><span class="line">            <span class="keyword">var</span> pxY = svg.attr( <span class="string">&quot;height&quot;</span> );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> makeScale = <span class="function"><span class="keyword">function</span>(<span class="params"> accessor, range</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> d3.scaleLinear()</span><br><span class="line">                    .domain(d3.extent(data, accessor))</span><br><span class="line">                    .range( range ).nice();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> scX = makeScale( <span class="function"><span class="params">d</span> =&gt;</span> d[<span class="string">&quot;x&quot;</span>], [<span class="number">0</span>, pxX]);</span><br><span class="line">            <span class="keyword">var</span> scY1 = makeScale( <span class="function"><span class="params">d</span> =&gt;</span> d[<span class="string">&quot;y1&quot;</span>], [pxY, <span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">var</span> scY2 = makeScale( <span class="function"><span class="params">d</span> =&gt;</span> d[<span class="string">&quot;y2&quot;</span>], [pxY, <span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> drawData = <span class="function"><span class="keyword">function</span>(<span class="params">g, accessor, curve</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// draw circles</span></span><br><span class="line">                g.selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">                    .data(data).enter().append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">                    .attr(<span class="string">&quot;r&quot;</span>, <span class="number">5</span>)</span><br><span class="line">                    .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="params">d</span>=&gt;</span>scX(d[<span class="string">&quot;x&quot;</span>]))</span><br><span class="line">                    .attr(<span class="string">&quot;cy&quot;</span>, accessor);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// draw lines</span></span><br><span class="line">                <span class="keyword">var</span> lineMaker = d3.line().curve( curve )</span><br><span class="line">                    .x( <span class="function"><span class="params">d</span> =&gt;</span> scX( d[<span class="string">&quot;x&quot;</span>] ) )</span><br><span class="line">                    .y( accessor );</span><br><span class="line">                g.append( <span class="string">&quot;path&quot;</span> )</span><br><span class="line">                    .attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span> )</span><br><span class="line">                    .attr( <span class="string">&quot;d&quot;</span>, lineMaker(data) );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> g1 = svg.append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> g2 = svg.append(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">            drawData( g1, <span class="function"><span class="params">d</span> =&gt;</span> scY1( d[<span class="string">&quot;y1&quot;</span>] ), d3.curveStep);</span><br><span class="line">            drawData( g2, <span class="function"><span class="params">d</span> =&gt;</span> scY2( d[<span class="string">&quot;y2&quot;</span>] ), d3.curveNatural);</span><br><span class="line"></span><br><span class="line">            g1.selectAll( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;green&quot;</span>);</span><br><span class="line">            g1.selectAll( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;cyan&quot;</span>);</span><br><span class="line"></span><br><span class="line">            g2.selectAll( <span class="string">&quot;circle&quot;</span> ).attr( <span class="string">&quot;fill&quot;</span>, <span class="string">&quot;blue&quot;</span>);</span><br><span class="line">            g2.selectAll( <span class="string">&quot;path&quot;</span> ).attr( <span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> axMkr = d3.axisRight( scY1 ); <span class="comment">// 所有元素都是由左上角的原點畫起，所以是這會是在圖形的左邊畫出軸，在軸的右邊標出刻度</span></span><br><span class="line">            axMkr( svg.append(<span class="string">&quot;g&quot;</span>) ); <span class="comment">// 將軸元素附加到一個容器元素中，通常是使用 &lt;g&gt;</span></span><br><span class="line"></span><br><span class="line">            axMkr = d3.axisLeft( scY2 );</span><br><span class="line">            svg.append( <span class="string">&quot;g&quot;</span> )</span><br><span class="line">                .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + pxX + <span class="string">&quot;,0)&quot;</span> ) <span class="comment">// 因為繪圖是由左上角的原點畫起，所以我們要將元素都往右邊移</span></span><br><span class="line">                .call( axMkr ); <span class="comment">// call() 會呼叫傳入的參數 axMkr，此參數為一個 function 就會被呼叫用來會軸</span></span><br><span class="line"></span><br><span class="line">            svg.append( <span class="string">&quot;g&quot;</span> ).call( d3.axisTop( scX ) )</span><br><span class="line">                .attr( <span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(0,&quot;</span>+pxY+<span class="string">&quot;)&quot;</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo3&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">300</span>)</span><br><span class="line">          .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">600</span>)</span><br><span class="line">          .style(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">          makeDemo3()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo3;</span><br></pre></td></tr></table></figure>
<p>顯示結果</p>
<img src="/2022/01/23/frontend-d3-002-installing/05.png" class="" title="05.png">

<h1 id="互動"><a href="#互動" class="headerlink" title="互動"></a>互動</h1><ol>
<li>D3 不只可以產生 SVG，也可以操作 DOM </li>
<li>可依據事件加以回應<br>src/components/Demo4/index.js<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> d3 <span class="keyword">from</span> <span class="string">&#x27;d3&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo4</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> vs = [<span class="string">&quot;From East&quot;</span>, <span class="string">&quot;to West&quot;</span>, <span class="string">&quot;at Home&quot;</span>, <span class="string">&quot;is Best&quot;</span>]</span><br><span class="line">        d3.select(<span class="string">&#x27;.Demo4&#x27;</span>)</span><br><span class="line">          .append(<span class="string">&#x27;ul&#x27;</span>).selectAll(<span class="string">&quot;li&quot;</span>)</span><br><span class="line">          .data(vs).enter()</span><br><span class="line">          .append(<span class="string">&quot;li&quot;</span>).text(<span class="function"><span class="params">d</span>=&gt;</span>d)</span><br><span class="line">          .on( <span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">              <span class="built_in">this</span>.toggleState = !<span class="built_in">this</span>.toggleState;</span><br><span class="line">              d3.select(<span class="built_in">this</span>)  <span class="comment">// 選擇被點選的元素</span></span><br><span class="line">              .transition().duration(<span class="number">1000</span>)</span><br><span class="line">              .style(<span class="string">&quot;color&quot;</span>, <span class="built_in">this</span>.toggleState?<span class="string">&quot;red&quot;</span>:<span class="string">&quot;black&quot;</span>)</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;Demo4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo4;</span><br></pre></td></tr></table></figure>
點選第一個項目的結果顯示<img src="/2022/01/23/frontend-d3-002-installing/06.png" class="" title="06.png"></li>
</ol>
<h1 id="參考與出處"><a href="#參考與出處" class="headerlink" title="參考與出處"></a>參考與出處</h1><p><a target="_blank" rel="noopener" href="https://github.com/janert/d3-for-the-impatient">https://github.com/janert/d3-for-the-impatient</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Steven Wu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">127</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">129</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/pluto123" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;pluto123" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yuh.chang.wu@gmail.com" title="E-Mail → mailto:yuh.chang.wu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Steven Wu</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">489k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">7:25</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span><br></span>	

<span class="post-meta-item-icon">
    <i class="fa fa-users"></i>
</span>
<span>總訪客：&nbsp<span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp人</span>
    <span class="post-meta-divider">|</span>
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span>總訪問量：&nbsp<span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp次</span>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


</body>
</html>
